<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Simulation of Python code from traces in Coq | Formal Land</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://formal.land/img/land-512.png"><meta data-rh="true" name="twitter:image" content="https://formal.land/img/land-512.png"><meta data-rh="true" property="og:url" content="https://formal.land/blog/2024/05/22/translation-of-python-code-simulations-from-trace"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Simulation of Python code from traces in Coq | Formal Land"><meta data-rh="true" name="description" content="In order to formally verify Python code in Coq our approach is the following:"><meta data-rh="true" property="og:description" content="In order to formally verify Python code in Coq our approach is the following:"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2024-05-22T00:00:00.000Z"><meta data-rh="true" property="article:tag" content="coq-of-python,Python,Coq,translation,Ethereum,simulation,trace"><link data-rh="true" rel="icon" href="/img/land-512.png"><link data-rh="true" rel="canonical" href="https://formal.land/blog/2024/05/22/translation-of-python-code-simulations-from-trace"><link data-rh="true" rel="alternate" href="https://formal.land/blog/2024/05/22/translation-of-python-code-simulations-from-trace" hreflang="en"><link data-rh="true" rel="alternate" href="https://formal.land/blog/2024/05/22/translation-of-python-code-simulations-from-trace" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Formal Land RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Formal Land Atom Feed">



<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MQLHF4EV4J"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-MQLHF4EV4J",{anonymize_ip:!0})</script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.34e7cd30.css">
<script src="/assets/js/runtime~main.3ea36be4.js" defer="defer"></script>
<script src="/assets/js/main.9798b558.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#fafbfc;color:#091E42" role="banner"><div class="content_knG7 announcementBarContent_xLdY">For our services, email us at <a href="mailto:&#099;&#111;&#110;&#116;&#097;&#099;&#116;&#064;formal&#046;&#108;&#097;&#110;&#100;">&#099;&#111;&#110;&#116;&#097;&#099;&#116;&#064;formal&#046;&#108;&#097;&#110;&#100;</a>&nbsp;💌&nbsp;!</div></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/land-512.png" alt="Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/land-512.png" alt="Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Formal Land</b></a><a class="navbar__item navbar__link" href="/docs/company/about">Company</a><a class="navbar__item navbar__link" href="/docs/coq-of-rust/introduction">coq-of-rust</a><a class="navbar__item navbar__link" href="/docs/coq-of-ocaml/introduction">coq-of-ocaml</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/formal-land" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://gitlab.com/formal-land" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitLab<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/2024/05/22/translation-of-python-code-simulations-from-trace">Simulation of Python code from traces in Coq</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2024/05/14/translation-of-python-code-simulations">Simulation of Python code in Coq</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2024/05/10/translation-of-python-code">Translation of Python code to Coq</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2024/04/26/translation-core-alloc-crates">Translation of the Rust&#x27;s core and alloc crates</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2024/04/03/monadic-notation-for-rust-translation">Monadic notation for the Rust translation</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="https://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="In order to formally verify Python code in Coq our approach is the following:"><header><h1 class="title_f1Hy" itemprop="headline">Simulation of Python code from traces in Coq</h1><div class="container_mt6G margin-vert--md"><time datetime="2024-05-22T00:00:00.000Z" itemprop="datePublished">May 22, 2024</time> · <!-- -->9 min read</div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p>In order to formally verify Python code in Coq our approach is the following:</p>
<ol>
<li>Import Python code in Coq by running <a href="https://github.com/formal-land/coq-of-python" target="_blank" rel="noopener noreferrer">coq-of-python</a>.</li>
<li>Write a purely functional simulation in Coq of the code.</li>
<li>Show that this simulation is equivalent to the translation.</li>
<li>Verify the simulation.</li>
</ol>
<p>We will show in this article how we can merge the steps 2. and 3. to save time in the verification process. We do so by relying on the proof mode of Coq and unification.</p>
<p>Our mid-term goal is to formally specify the <a href="https://ethereum.org/en/developers/docs/evm/" target="_blank" rel="noopener noreferrer">Ethereum Virtual Machine</a> (EVM) and prove that this specification is correct according to <a href="https://github.com/ethereum/execution-specs" target="_blank" rel="noopener noreferrer">reference implementation of the EVM</a> in Python. This would ensure that it is always up-to-date and exhaustive. The code of this project is open-source and available on GitHub: <a href="https://github.com/formal-land/coq-of-python" target="_blank" rel="noopener noreferrer">formal-land/coq-of-python</a>.</p>
<figure><p><img decoding="async" loading="lazy" alt="Python at work" src="/assets/images/python-09005453d956898e591da18953b4d13a.webp" width="1024" height="1024" class="img_ev3q"></p></figure>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="our-pythons-monad">Our Python&#x27;s monad 🐍<a href="#our-pythons-monad" class="hash-link" aria-label="Direct link to Our Python&#x27;s monad 🐍" title="Direct link to Our Python&#x27;s monad 🐍">​</a></h2>
<p>We put the Python code that we import in Coq in a monad <code>M</code> to represent all the features that are hard to express in Coq, mainly the side effects. This monad is a combination of two levels:</p>
<ul>
<li><code>LowM</code> for the side effects except the control flow.</li>
<li><code>M</code> that adds an error monad on top of <code>LowM</code> to handle the control flow (exceptions, <code>break</code> instruction, ...).</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="lowm">LowM<a href="#lowm" class="hash-link" aria-label="Direct link to LowM" title="Direct link to LowM">​</a></h3>
<p>Here is the definition of the <code>LowM</code> monad in <a href="https://github.com/formal-land/coq-of-python/blob/main/CoqOfPython/CoqOfPython.v" target="_blank" rel="noopener noreferrer">CoqOfPython.v</a>:</p>
<div class="language-coq codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-coq codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">Module</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Primitive</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">Inductive</span><span class="token plain"> t </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Set</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Set</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> StateAlloc </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">object </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t Value</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> t </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Pointer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t Value</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> StateRead </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mutable </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pointer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Mutable</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t Value</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> t </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t Value</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> StateWrite </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mutable </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pointer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Mutable</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t Value</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">update </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t Value</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> t unit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> GetInGlobals </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">globals </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Globals</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> t Value</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">End</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Primitive</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">Module</span><span class="token plain"> LowM</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">Inductive</span><span class="token plain"> t </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">A </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Set</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Set</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> Pure </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> A</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> CallPrimitive </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">B </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Set</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">primitive </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Primitive</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t B</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">k </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> B </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> t A</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> CallClosure </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">B </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Set</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">closure </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t Value</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">args kwargs </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Value</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">k </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> B </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> t A</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> Impossible</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">Arguments</span><span class="token plain"> Pure </span><span class="token punctuation" style="color:#393A34">{</span><span class="token keyword" style="color:#00009f">_</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">Arguments</span><span class="token plain"> CallPrimitive </span><span class="token punctuation" style="color:#393A34">{</span><span class="token keyword" style="color:#00009f">_</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">_</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">Arguments</span><span class="token plain"> CallClosure </span><span class="token punctuation" style="color:#393A34">{</span><span class="token keyword" style="color:#00009f">_</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">_</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">Arguments</span><span class="token plain"> Impossible </span><span class="token punctuation" style="color:#393A34">{</span><span class="token keyword" style="color:#00009f">_</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">Fixpoint</span><span class="token plain"> bind </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">A B </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Set</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e1 </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> t A</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e2 </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> A </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> t B</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> t B </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">match</span><span class="token plain"> e1 </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> Pure a </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> e2 a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> CallPrimitive primitive k </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> CallPrimitive primitive </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> v </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> bind </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">k v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> e2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> CallClosure closure args kwargs k </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> CallClosure closure args kwargs </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> bind </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">k a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> e2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> Impossible </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> Impossible</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">end</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">End</span><span class="token plain"> LowM</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This is a monad defined by continuation (the variable <code>k</code>):</p>
<ul>
<li>We terminate a computation with the primitive <code>Pure</code> and some result <code>a</code>, that can be any purely functional expression.</li>
<li>We can call some primitives grouped in <code>Primitive.t</code> that are side effects:<!-- -->
<ul>
<li><code>StateAlloc</code> to allocate a new object in the memory,</li>
<li><code>StateRead</code> to read an object from the memory,</li>
<li><code>StateWrite</code> to write an object in the memory,</li>
<li><code>GetInGlobals</code> to read a global variable, doing name resolution. This is a side effects as function definitions in Python do not need to be ordered.</li>
</ul>
</li>
<li>We can call a closure (an anonymous function) with <code>CallClosure</code>. This is required for termination, as we cannot define an eval function on the type of Python values since some do not terminate like the <a href="https://medium.com/@dkeout/why-you-must-actually-understand-the-%CF%89-and-y-combinators-c9204241da7a" target="_blank" rel="noopener noreferrer">Ω expression</a>. See our previous post <a href="/blog/2024/05/10/translation-of-python-code">Translation of Python code to Coq</a> for our definition of Python values. The combinator <code>CallClosure</code> is also very convenient to modularize our proofs: we reason on each closure independently.</li>
<li>We can mark a code path as unreachable with <code>Impossible</code>.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="m">M<a href="#m" class="hash-link" aria-label="Direct link to M" title="Direct link to M">​</a></h3>
<p>The final monad <code>M</code> is defined as:</p>
<div class="language-coq codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-coq codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">Definition</span><span class="token plain"> M </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Set</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  LowM</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Value</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> Exception</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It has no parameters as Python is untyped, so all expressions have the same result type:</p>
<ul>
<li>either a success value of type <code>Value.t</code>,</li>
<li>or an exception of type <code>Exception.t</code>, with some special cases to represent a <code>return</code>, a <code>break</code>, or a <code>continue</code> instruction.</li>
</ul>
<p>We define the monadic bind of <code>M</code> like for the error monad:</p>
<div class="language-coq codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-coq codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">Definition</span><span class="token plain"> bind </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e1 </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> M</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e2 </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Value</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> M</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> M </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  LowM</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bind e1 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> v </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">match</span><span class="token plain"> v </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> inl v </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> e2 v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> inr e </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> LowM</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Pure </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">inr e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="traces">Traces 🐾<a href="#traces" class="hash-link" aria-label="Direct link to Traces 🐾" title="Direct link to Traces 🐾">​</a></h2>
<p>We define our semantics of a computation <code>e</code> of type <code>M</code> in <a href="https://github.com/formal-land/coq-of-python/blob/main/CoqOfPython/simulations/proofs/CoqOfPython.v" target="_blank" rel="noopener noreferrer">simulations/proofs/CoqOfPython.v</a> with the predicate:</p>
<div class="language-coq codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-coq codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> stack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> heap </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> e ⇓ to_value </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> P_stack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> P_heap </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>that we call a <em>run</em> or a <em>trace</em>, saying that:</p>
<ul>
<li>starting from the initial state <code>stack</code>, <code>heap</code>,</li>
<li>the computation <code>e</code> terminates with a value,</li>
<li>that is in the image of the function <code>to_value</code>,</li>
<li>and with a final stack and heap that satisfy the predicates <code>P_stack</code> and <code>P_heap</code>.</li>
</ul>
<p>Note that we do not explicit the resulting value and memory state of a computation in this predicate. We only say that it exists and verifies a few properties, that are here for compositionality. We have a purely functional function <code>evaluate</code> that can derive the result of a run of a computation:</p>
<div class="language-coq codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-coq codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">evaluate </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">forall</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">`{</span><span class="token keyword" style="color:#00009f">Heap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Trait</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">A B </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Set</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">stack </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Stack</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">heap </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Heap</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">e </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> LowM</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t B</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">to_value </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> A </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> B</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">P_stack </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Stack</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Prop</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">P_heap </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Heap</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Prop</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">run </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> stack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> heap </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> e ⇓ to_value </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> P_stack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> P_heap </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  A </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> stack </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Stack</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> P_stack stack </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> heap </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Heap</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> P_heap heap </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The function <code>evaluate</code> is defined in Coq by a <code>Fixpoint</code>. Its result is what we call a <em>simulation</em>, which is a purely functional definition equivalent to the orignal computation <code>e</code> from Python. It is equivalent by construction.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="building-a-trace">Building a trace 🔨<a href="#building-a-trace" class="hash-link" aria-label="Direct link to Building a trace 🔨" title="Direct link to Building a trace 🔨">​</a></h2>
<p>A trace is an inductive in <code>Set</code> that we can build with the following constructors:</p>
<div class="language-coq codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-coq codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">Inductive</span><span class="token plain"> t </span><span class="token punctuation" style="color:#393A34">`{</span><span class="token keyword" style="color:#00009f">Heap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Trait</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">A B </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Set</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">stack </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Stack</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">heap </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Heap</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">to_value </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> A </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> B</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">P_stack </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Stack</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Prop</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">P_heap </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Heap</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Prop</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LowM</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t B </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Set</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">(* [Pure] primitive *)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> Pure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> A</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token operator" style="color:#393A34">&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> B</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  result</span><span class="token operator" style="color:#393A34">&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> to_value result </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  P_stack stack </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  P_heap heap </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> stack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> heap </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LowM</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Pure result</span><span class="token operator" style="color:#393A34">&#x27;</span><span class="token plain"> ⇓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    to_value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> P_stack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> P_heap </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">(* [StateRead] primitive *)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> CallPrimitiveStateRead</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mutable </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pointer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Mutable</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t Value</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">object </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t Value</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">k </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t Value</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> LowM</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t B</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  IsRead</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t stack heap mutable object </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> stack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> heap </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    k object ⇓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    to_value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> P_stack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> P_heap </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> stack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> heap </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LowM</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CallPrimitive </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">Primitive</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">StateRead mutable</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> k ⇓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    to_value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> P_stack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> P_heap </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">(* [CallClosure] primitive *)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> CallClosure </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">C </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Set</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">f </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Value</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> Value</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> M</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">args kwargs </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Value</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">to_value_inter </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> C </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> Value</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> Exception</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">P_stack_inter </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Stack</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Prop</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">P_heap_inter </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Heap</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Prop</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">k </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Value</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> Exception</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> LowM</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t B</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> closure </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> Data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Closure f </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> stack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> heap </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    f args kwargs ⇓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    to_value_inter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> P_stack_inter</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> P_heap_inter </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">(* We quantify over every possible values as we cannot compute the result of the closure here.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">      We only know that it exists and respects some constraints in this inductive definition. *)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">forall</span><span class="token plain"> value_inter stack_inter heap_inter</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    P_stack_inter stack_inter </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    P_heap_inter heap_inter </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> stack_inter</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> heap_inter </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      k </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">to_value_inter value_inter</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ⇓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      to_value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> P_stack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> P_heap </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> stack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> heap </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LowM</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CallClosure closure args kwargs k ⇓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    to_value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> P_stack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> P_heap </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">(* ...cases for the other primitives of the monad... *)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pure">Pure<a href="#pure" class="hash-link" aria-label="Direct link to Pure" title="Direct link to Pure">​</a></h3>
<p>In the <code>Pure</code> case we return the final result of the computation. We check the state fulfills the predicate <code>P_stack</code> and <code>P_heap</code>, and that the result is the image by the function <code>to_value</code> of some <code>result</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="callprimitivestateread">CallPrimitiveStateRead<a href="#callprimitivestateread" class="hash-link" aria-label="Direct link to CallPrimitiveStateRead" title="Direct link to CallPrimitiveStateRead">​</a></h3>
<p>To read a value in memory, we rely on another predicate <code>IsRead</code> that checks if the <code>mutable</code> pointer is valid in the <code>stack</code> or <code>heap</code> and that the <code>object</code> is the value at this pointer. We then call the continuation <code>k</code> with this object. We have similar rules for allocating a new object in memory and writing at a pointer.</p>
<p>Note that we parameterize all our semantics by <code> `{Heap.Trait}</code> that provides a specific <code>Heap</code> type with read and write primitives. We can choose the implementation of the memory model that we want to use in our simulations in order to simplify the reasoning.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="callclosure">CallClosure<a href="#callclosure" class="hash-link" aria-label="Direct link to CallClosure" title="Direct link to CallClosure">​</a></h3>
<p>To call a closure, we first evaluate the closure with the arguments and keyword arguments. We then call the continuation <code>k</code> with the result of the closure. We quantify over all possible results of the closure, as we cannot compute it here. This would require to be able to define <code>Fixpoint</code> together with <code>Inductive</code>, which is not possible in Coq. So we only know that the result of the closure exists, and can use the constraints on its result (the function <code>to_value</code> and the predicates <code>P_stack_inter</code> and <code>P_heap_inter</code>) to build a run of the continuation.</p>
<p>The other constructors are not presented here but are similar to the above. We will also add a monadic primitive for loops with the following idea: we show that a loop terminates by building a trace, as traces are <code>Inductive</code> so must be finite. We have no rules for the <code>Impossible</code> case so that building the trace of a computation also shows that the <code>Impossible</code> calls are in unreachable paths.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="example">Example 🔍<a href="#example" class="hash-link" aria-label="Direct link to Example 🔍" title="Direct link to Example 🔍">​</a></h2>
<p>We have applied these technique to a small code example with allocation, memory read, and closure call primitives. We were able to show that the resulting simulation obtained by running <code>evaluate</code> on the trace is equal to a simulation written by hand. The proof was just the tactic <code>reflexivity</code>. We believe that we can automate most of the tactics used to build a run, except for the allocations were the user needs to make a choice (immediate, stack, or heap allocation, which address, ...).</p>
<p>To continue our experiments we now need to complete our semantics of Python, especially to take into account method and operator calls.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2>
<p>We have presented an alternative way to build simulations of imperative Python code in purely functional Coq code. The idea is to enable faster reasoning over Python code by removing the need to build explicit simulations. We plan to port this technique to other tools like <a href="https://github.com/formal-land/coq-of-rust" target="_blank" rel="noopener noreferrer">coq-of-rust</a> as well.</p>
<p>To see what we can do for you talk with us at <a href="mailto:contact@formal.land" target="_blank" rel="noopener noreferrer">contact@formal.land</a> 🏇. For our previous projects, see our <a href="https://formal-land.gitlab.io/coq-tezos-of-ocaml/" target="_blank" rel="noopener noreferrer">formal verification of the Tezos&#x27; L1</a>!</p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/coq-of-python">coq-of-python</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/python">Python</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/coq">Coq</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/translation">translation</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/ethereum">Ethereum</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/simulation">simulation</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/trace">trace</a></li></ul></div></footer></article><div style="margin-top:40px"></div><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--next" href="/blog/2024/05/14/translation-of-python-code-simulations"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Simulation of Python code in Coq</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#our-pythons-monad" class="table-of-contents__link toc-highlight">Our Python&#39;s monad 🐍</a><ul><li><a href="#lowm" class="table-of-contents__link toc-highlight">LowM</a></li><li><a href="#m" class="table-of-contents__link toc-highlight">M</a></li></ul></li><li><a href="#traces" class="table-of-contents__link toc-highlight">Traces 🐾</a></li><li><a href="#building-a-trace" class="table-of-contents__link toc-highlight">Building a trace 🔨</a><ul><li><a href="#pure" class="table-of-contents__link toc-highlight">Pure</a></li><li><a href="#callprimitivestateread" class="table-of-contents__link toc-highlight">CallPrimitiveStateRead</a></li><li><a href="#callclosure" class="table-of-contents__link toc-highlight">CallClosure</a></li></ul></li><li><a href="#example" class="table-of-contents__link toc-highlight">Example 🔍</a></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Content</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/company/about">Company</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/company/claims">Claims</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/company/press">Press</a></li></ul></div><div class="col footer__col"><div class="footer__title">Links</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/LandFoobar" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://fr.linkedin.com/company/formal-land" target="_blank" rel="noopener noreferrer" class="footer__link-item">Linkedin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://t.me/formal_land" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.tiktok.com/@formal.land" target="_blank" rel="noopener noreferrer" class="footer__link-item">TikTok<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="mailto:contact@formal.land" target="_blank" rel="noopener noreferrer" class="footer__link-item">Email<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/formal-land" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://gitlab.com/formal-land" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitLab<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://formal-land.gitlab.io/coq-tezos-of-ocaml/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Coq Tezos of OCaml<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Formal Land (Arae SARL) 🐦, Paris<br><em>Formal verification for everyday-life applications 🏇</em><!-- Start of LiveChat (www.livechat.com) code -->
<script>window.__lc=window.__lc||{},window.__lc.license=14938650,function(n,t,c){function i(n){return e._h?e._h.apply(null,n):e._q.push(n)}var e={_q:[],_h:null,_v:"2.0",on:function(){i(["on",c.call(arguments)])},once:function(){i(["once",c.call(arguments)])},off:function(){i(["off",c.call(arguments)])},get:function(){if(!e._h)throw new Error("[LiveChatWidget] You can't use getters before load.");return i(["get",c.call(arguments)])},call:function(){i(["call",c.call(arguments)])},init:function(){var n=t.createElement("script");n.async=!0,n.type="text/javascript",n.src="https://cdn.livechatinc.com/tracking.js",t.head.appendChild(n)}};!n.__lc.asyncInit&&e.init(),n.LiveChatWidget=n.LiveChatWidget||e}(window,document,[].slice)</script>
<noscript><a href="https://www.livechat.com/chat-with/14938650/" rel="nofollow">Chat with us</a>, powered by <a href="https://www.livechat.com/?welcome" rel="noopener nofollow" target="_blank">LiveChat</a></noscript>
<!-- End of LiveChat code --></div></div></div></footer></div>
</body>
</html>