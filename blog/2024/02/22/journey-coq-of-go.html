<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Formal Land RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Formal Land Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MQLHF4EV4J"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-MQLHF4EV4J",{anonymize_ip:!0})</script><title data-react-helmet="true">Translating Go to Coq, part 1 | Formal Land</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://formal.land/img/land-512.png"><meta data-react-helmet="true" name="twitter:image" content="https://formal.land/img/land-512.png"><meta data-react-helmet="true" property="og:url" content="https://formal.land/blog/2024/02/22/journey-coq-of-go"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="Translating Go to Coq, part 1 | Formal Land"><meta data-react-helmet="true" name="description" content="In this blog post, we present our development steps to build a tool to translate Go programs to the proof system Coq."><meta data-react-helmet="true" property="og:description" content="In this blog post, we present our development steps to build a tool to translate Go programs to the proof system Coq."><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2024-02-22T00:00:00.000Z"><meta data-react-helmet="true" property="article:tag" content="coq-of-go,Go,Coq,translation"><link data-react-helmet="true" rel="icon" href="/img/land-512.png"><link data-react-helmet="true" rel="canonical" href="https://formal.land/blog/2024/02/22/journey-coq-of-go"><link data-react-helmet="true" rel="alternate" href="https://formal.land/blog/2024/02/22/journey-coq-of-go" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://formal.land/blog/2024/02/22/journey-coq-of-go" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.20dc303f.css">
<link rel="preload" href="/assets/js/runtime~main.b15903ae.js" as="script">
<link rel="preload" href="/assets/js/main.eb2a146d.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" style="background-color:#fafbfc;color:#091E42" role="banner"><div class="announcementBarContent_3EUC">For formal verification services, email us at <a href="mailto:&#099;&#111;&#110;&#116;&#097;&#099;&#116;&#064;formal&#046;&#108;&#097;&#110;&#100;">&#099;&#111;&#110;&#116;&#097;&#099;&#116;&#064;formal&#046;&#108;&#097;&#110;&#100;</a>!</div></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/land-512.png" alt="Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/land-512.png" alt="Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Formal Land</b></a><a class="navbar__item navbar__link" href="/docs/company/about">Company</a><a class="navbar__item navbar__link" href="/docs/verification/ocaml">Formal verification</a><a class="navbar__item navbar__link" href="/docs/services/solidity-development">Services</a><a class="navbar__item navbar__link" href="/docs/coq-of-ocaml/introduction">coq-of-ocaml</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/formal-land" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://gitlab.com/formal-land" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitLab<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">Recent posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a aria-current="page" class="sidebarItemLink_1RT6 sidebarItemLinkActive_12pM" href="/blog/2024/02/22/journey-coq-of-go">Translating Go to Coq, part 1</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2024/02/14/experiment-coq-of-hs">Experiment on translation from Haskell to Coq</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2024/02/02/formal-verification-for-aleph-zero">The importance of formal verification</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2024/01/18/update-coq-of-rust">Upgrade the Rust version of coq-of-rust</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2024/01/04/rust-translating-match">Translating Rust match patterns to Coq with coq-of-rust</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_GeHD" itemprop="headline">Translating Go to Coq, part 1</h1><div class="blogPostData_291c margin-vert--md"><time datetime="2024-02-22T00:00:00.000Z" itemprop="datePublished">February 22, 2024</time> · <!-- -->13 min read</div></header><div class="markdown" itemprop="articleBody"><p>In this blog post, we present our development steps to build a tool to translate Go programs to the proof system Coq.</p><p>The goal is to formally verify Go programs to make them totally bug-free. It is actually possible to make a program totally bug-free, as <a href="https://en.wikipedia.org/wiki/Formal_verification" target="_blank" rel="noopener noreferrer">formal verification</a> can cover all execution cases and kinds of properties thanks to the use of mathematical methods. This corresponds to the highest level of the <a href="https://en.wikipedia.org/wiki/Evaluation_Assurance_Level" target="_blank" rel="noopener noreferrer">Evaluation Assurance Levels</a> used for critical applications, such as the space industry.</p><p>All the code of our work is available on GitHub at <a href="https://github.com/formal-land/coq-of-go-experiment" target="_blank" rel="noopener noreferrer">github.com/formal-land/coq-of-go-experiment</a>.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="introduction">Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">​</a></h2><p>We believe that there are not yet a lot of formal verification tools for Go. We can cite <a href="https://github.com/tchajed/goose" target="_blank" rel="noopener noreferrer">Goose</a>, which is working by translation from Go to the proof system Coq. We will follow a similar approach, translating the Go language to our favorite proof system Coq. In contrast to Goose, we plan to support the whole Go language, even at the expense of the simplicity of the translation.</p><p>For that, we target the translation of the <a href="https://pkg.go.dev/golang.org/x/tools/go/ssa" target="_blank" rel="noopener noreferrer">SSA form of Go</a> of Go instead of the <a href="https://pkg.go.dev/go/ast" target="_blank" rel="noopener noreferrer">Go AST</a>. The SSA form is a more low-level representation of Go, so we hope to capture the semantics of the whole Go language more easily. This should be at the expense of the simplicity of the generated translation, but we hope that having full language support outweighs this.</p><p>Go is an interesting target as:</p><ul><li>this is quite a popular language,</li><li>it is focusing on simplicity, with a reduced set of language features,</li><li>a lot of critical backend applications are written in Go, including for very large companies (Google, Netflix, Uber, Twitch, etc.).</li></ul><p>Among interesting properties that we can verify are:</p><ul><li>the absence of reachable <code>panic</code> in the code,</li><li>the absence of race conditions or deadlocks,</li><li>the backward compatibility from release to release, for parts of the code whose behavior is not supposed to change,</li><li>the strict application of business rules.</li></ul><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Contact</h5></div><div class="admonition-content"><p>You can <a href="https://twitter.com/LandFoobar" target="_blank" rel="noopener noreferrer">follow us on X</a> to get our updates. We propose tools and services to make your codebase totally bug-free. Contact us at<!-- --> <a href="mailto:contact@formal.land" target="_blank" rel="noopener noreferrer">c<!-- -->o<!-- -->n<!-- -->t<!-- -->a<!-- -->c<!-- -->t<!-- -->@<!-- -->formal<!-- -->.<!-- -->l<!-- -->a<!-- -->n<!-- -->d</a> to chat! We offer a free audit to assess the feasibility of formal verification on your case.</p></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Goal</h5></div><div class="admonition-content"><p>Our company goal is to make formal verification accessible to all projects, reducing its cost to<!-- --> <!-- -->20% of the development cost. There should be no reason to have bugs in end-user products!</p></div></div><p><img alt="Mole and Rooster" src="/assets/images/mole_rooster-69abedffe91c988310aef61e9bf9d2e3.webp"></p><h2 class="anchor anchorWithStickyNavbar_31ik" id="first-target">First target<a class="hash-link" href="#first-target" title="Direct link to heading">​</a></h2><p>Our first target is to achieve the formal verification <em>including all the dependencies</em> of the hello world program:</p><div class="codeBlockContainer_K1bP language-go theme-code-block"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;fmt&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Hello, World!&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>What we want to show about this code is that it does a single and only thing: outputting the string &quot;Hello, World!&quot; to the standard output. Its only dependency is the <code>fmt</code> package, but when we look at the transitive dependencies of this package:</p><div class="codeBlockContainer_K1bP language-sh theme-code-block"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">go list -f &#x27;{{ .Deps }}&#x27; fmt</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>we get around forty packages:</p><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">errors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">internal/abi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">internal/bytealg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">internal/coverage/rtcov</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">internal/cpu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">internal/fmtsort</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">internal/goarch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">internal/godebugs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">internal/goexperiment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">internal/goos</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">internal/itoa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">internal/oserror</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">internal/poll</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">internal/race</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">internal/reflectlite</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">internal/safefilepath</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">internal/syscall/execenv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">internal/syscall/unix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">internal/testlog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">internal/unsafeheader</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">io/fs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">math</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">math/bits</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reflect</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">runtime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">runtime/internal/atomic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">runtime/internal/math</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">runtime/internal/sys</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">runtime/internal/syscall</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sort</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">strconv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sync</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sync/atomic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">syscall</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unicode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unicode/utf8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unsafe</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>We will need to translate all these packages to meaningful Coq code.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="the-start">The start<a class="hash-link" href="#the-start" title="Direct link to heading">​</a></h2><p>We made the <code>coq-of-go</code> tool, with everything in a single file <a href="https://github.com/formal-land/coq-of-go-experiment/blob/main/main.go" target="_blank" rel="noopener noreferrer">main.go</a> for now. We retrieve the SSA form of a Go package provided as a command line parameter (code without the error handling):</p><div class="codeBlockContainer_K1bP language-go theme-code-block"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    packageToTranslate </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Args</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cfg </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">packages</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Config</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">Mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> packages</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">LoadSyntax</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    initial</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> packages</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cfg</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> packageToTranslate</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token boolean" style="color:#36acaa">_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pkgs </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> ssautil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Packages</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">initial</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pkgs</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    members </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> pkgs</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Members</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>SSA form</h5></div><div class="admonition-content"><p>The <a href="https://en.wikipedia.org/wiki/Static_single-assignment_form" target="_blank" rel="noopener noreferrer">SSA form</a> of a program is generally used internally by compilers to have a simple representation to work on. The <a href="https://llvm.org/" target="_blank" rel="noopener noreferrer">LLVM</a> language is such an example. In SSA, each variable is assigned exactly once and the control flow is explicit, with jumps or conditional jumps to labels. There are no <code>for</code> loops, <code>if</code> statements, or non-primitive expressions.</p></div></div><p>Then we iterate over all the SSA <code>members</code>, and directly print the corresponding Coq code to the standard output. We do not use an intermediate representation or make intermediate passes. We do not even do pretty-printing (splitting lines that are too long at the right place, and introducing indentation)! This should not be necessary as the SSA code cannot nest sub-expressions or statements. We still try to print a readable Coq code, as it will be used in the proofs.</p><p>There are four kinds of SSA members:</p><ul><li>named constants,</li><li>globals,</li><li>types,</li><li>functions.</li></ul><p>Named constants and globals are similar, and are for top-level variables whose value is either known at compile-time or computed at the program&#x27;s init. Types are for type definitions. We will focus on functions, as this is where the code is.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="functions">Functions<a class="hash-link" href="#functions" title="Direct link to heading">​</a></h2><p>The SSA functions in Go are described by the type <a href="https://pkg.go.dev/golang.org/x/tools/go/ssa#Function" target="_blank" rel="noopener noreferrer"><code>ssa.Function</code></a>:</p><div class="codeBlockContainer_K1bP language-go theme-code-block"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> Function </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Signature </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">types</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Signature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// source information</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Synthetic </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// provenance of synthetic function; &quot;&quot; for true source functions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Pkg  </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Package </span><span class="token comment" style="color:#999988;font-style:italic">// enclosing package; nil for shared funcs (wrappers and error.Error)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Prog </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Program </span><span class="token comment" style="color:#999988;font-style:italic">// enclosing program</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Params    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Parameter  </span><span class="token comment" style="color:#999988;font-style:italic">// function parameters; for methods, includes receiver</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FreeVars  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">FreeVar    </span><span class="token comment" style="color:#999988;font-style:italic">// free variables whose values must be supplied by closure</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Locals    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Alloc      </span><span class="token comment" style="color:#999988;font-style:italic">// frame-allocated variables of this function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Blocks    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">BasicBlock </span><span class="token comment" style="color:#999988;font-style:italic">// basic blocks of the function; nil =&gt; external</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Recover   </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">BasicBlock   </span><span class="token comment" style="color:#999988;font-style:italic">// optional; control transfers here after recovered panic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AnonFuncs </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Function   </span><span class="token comment" style="color:#999988;font-style:italic">// anonymous functions directly beneath this one</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// contains filtered or unexported fields</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The main part of interest for us is<!-- --> <code>Blocks</code>. A block is a sequence of instructions, and the control flow is explicit. The last instruction of a block is a jump to another block, or a return. The first instructions of a block can be the special <code>Phi</code> instruction, which is used to merge control flow from different branches.</p><p>We decided to write a first version to see what the SSA code of Go looks like when printed in Coq, without thinking about generating a well-typed code. This looks like this:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">with MakeUint64 (α : list Val.t) : M (list Val.t) :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  M.Thunk (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  match α with</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | [x] =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    M.Thunk (M.EvalBody [(0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      let* &quot;t0&quot; := Instr.BinOp x &quot;&lt;&quot; (Val.Lit (Lit.Int 9223372036854775808)) in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Instr.If (Register.read &quot;t0&quot;) 1 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      let* &quot;t1&quot; := Instr.Convert x in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      let* &quot;t2&quot; := Instr.ChangeType (Register.read &quot;t1&quot;) in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      let* &quot;t3&quot; := Instr.MakeInterface (Register.read &quot;t2&quot;) in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      M.Return [(Register.read &quot;t3&quot;)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      let* &quot;t4&quot; := Instr.Alloc (* complit *) Alloc.Local &quot;*go/constant.intVal&quot; in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      let* &quot;t5&quot; := Instr.FieldAddr (Register.read &quot;t4&quot;) 0 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      let* &quot;t6&quot; := Instr.Call (CallKind.Function (newInt [])) in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      let* &quot;t7&quot; := Instr.Call (CallKind.Function (TODO_method [(Register.read &quot;t6&quot;); x])) in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      do* Instr.Store (Register.read &quot;t5&quot;) (Register.read &quot;t7&quot;) in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      let* &quot;t8&quot; := Instr.UnOp &quot;*&quot; (Register.read &quot;t4&quot;) in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      let* &quot;t9&quot; := Instr.MakeInterface (Register.read &quot;t8&quot;) in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      M.Return [(Register.read &quot;t9&quot;)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | _ =&gt; M.Thunk (M.EvalBody [])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>for a source Go code (from the <a href="https://pkg.go.dev/go/constant" target="_blank" rel="noopener noreferrer">go/constant</a> package):</p><div class="codeBlockContainer_K1bP language-go theme-code-block"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// MakeUint64 returns the [Int] value for x.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">MakeUint64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x </span><span class="token builtin">uint64</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> Value </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> x </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token number" style="color:#36acaa">63</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">int64Val</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">int64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> intVal</span><span class="token punctuation" style="color:#393A34">{</span><span class="token function" style="color:#d73a49">newInt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">SetUint64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>There are three blocks of code, labeled with <code>0</code>, <code>1</code>, and <code>2</code>. The first block ends with a conditional jump <code>If</code> corresponding to the <code>if</code> statement in the Go code. The following blocks are corresponding to the two possible branches of the <code>if</code> statement. They both end with a <code>Return</code> instruction, corresponding to the <code>return</code> statement in the Go code. They run various primitive instructions that we have translated as we can.</p><p>The generated Coq code is still readable but more verbose than the original Go code. We will later develop proof techniques using simulations to enable the user to define equivalent but simpler versions of the translation. Being able to define simulations of an imperative program is also important for the proofs, as we can rewrite the code in functional style to make it easier to reason about.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="type-checking">Type-checking<a class="hash-link" href="#type-checking" title="Direct link to heading">​</a></h2><p>From there, a second step is to have a generated code that type-checks, forgetting about making a code with sound semantics for now. We generate the various Coq definitions that are needed in a header of the generated code, using axioms for all the definitions. For example, for the allocations we do:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Module Alloc.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Inductive t : Set :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Heap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Local.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End Alloc.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Module Instr.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Parameter Alloc : Alloc.t -&gt; string -&gt; M Val.t.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The <code>Inductive</code> keyword in Coq defines a type with two constructors <code>Heap</code> and <code>Local</code>. The <code>Parameter</code> keyword defines an axiomatized definition, where we only provide the type but not the definition itself. The <code>Instr.Alloc</code> instruction takes as parameters an allocation mode <code>Alloc.t</code> and a string and returns an <code>M Val.t</code> value.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="representation-of-values">Representation of values<a class="hash-link" href="#representation-of-values" title="Direct link to heading">​</a></h3><p>We make the choice to remove the types while doing the translation, as the type system of Go is probably incompatible with the one of Coq in many ways. We thus translate everything to a single type <code>Val.t</code> in Coq to represent all kinds of possible Go values. The downside of this approach is that is makes the generated code less readable and less safe, as types are useful to track the correct use of values.</p><p>For now, we define the<!-- --> <code>Val.t</code> type as:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Module Val.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Inductive t : Set :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Lit (_ : Lit.t)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Tuple (_ : list t).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End Val.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>with the literals<!-- --> <code>Lit.t</code> as:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Module Lit.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Inductive t : Set :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Bool (_ : bool)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Int (_ : Z)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Float (_ : Rational)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Complex (_ _ : Rational)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | String (_ : string)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Nil.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End Lit.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>We plan to refine this type and add more cases as we improve <code>coq-of-go</code>. Structures, pointers, and closures are missing for now.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="monadic-style">Monadic style<a class="hash-link" href="#monadic-style" title="Direct link to heading">​</a></h3><p>In order to represent the side-effects of the Go code, we use a <a href="https://en.wikipedia.org/wiki/Monad_(functional_programming)" target="_blank" rel="noopener noreferrer">monadic style</a>. This is a standard approach to represent side-effects like mutations, exceptions, or non-termination in a purely function language such as Coq. We choose to use:</p><ul><li>A free monad, where all the primitives are constructor of the inductive type<!-- --> <code>M</code> of the monad. This simplifies the manipulation of the monad by allowing to compute on it and by delegating the actual implementation of the monadic primitives for later.</li><li>A co-inductive type, to allow potentially non-terminating programs. Co-inductive types are like lazy definitions in Haskell where it is possible to make an infinite list for example, as long as only a finite number of elements are consumed.</li></ul><p>In that sense, we follow the approach in the paper<!-- --> <a href="https://cambium.inria.fr/~eyoon/paper/vir.pdf" target="_blank" rel="noopener noreferrer">Modular, Compositional, and Executable Formal Semantics for LLVM IR</a>, that is using a co-inductive free monad (interaction tree) to formalize a reasonable subset of the LLVM language that is also an SSA representation but with more low-level instructions than Go.</p><p>Our definition for<!-- --> <code>M</code> for now is:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Module M.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  CoInductive t (A : Set) : Set :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Return (_ : A)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Bind {B : Set} (_ : t B) (_ : B -&gt; t A)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Thunk (_ : t A)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | EvalBody (_ : list (Z * t A)).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Arguments Return {A}.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Arguments Bind {A B}.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Arguments Thunk {A}.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Arguments EvalBody {A}.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End M.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Definition M : Set -&gt; Set := M.t.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>We define all the functions that we translate as mutually recursive with the <code>CoFixpoint ... with ...</code> keyword of Coq. Thus, we do not have to preserve the ordering of definitions that is required by Coq or care for recursive or mutually recursive functions in Go.</p><p>However, we did not achieve to make the type-checker of Coq happy for our<!-- --> <code>CoFixpoint</code> as many definitions are axiomatized, and the type-checker of Coq wants their definitions to know if they produce co-inductive constructors. So, for now, we admit this step by disabling the termination checker with this flag:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Local Unset Guard Checking.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="next">Next<a class="hash-link" href="#next" title="Direct link to heading">​</a></h2><p>When we translate our hello world example we get the Coq code:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">CoFixpoint Main (α : list Val.t) : M (list Val.t) :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  M.Thunk (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  match α with</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | [] =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    M.Thunk (M.EvalBody [(0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      let* &quot;t0&quot; := Instr.Alloc (* varargs *) Alloc.Heap &quot;*[1]any&quot; in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      let* &quot;t1&quot; := Instr.IndexAddr (Register.read &quot;t0&quot;) (Val.Lit (Lit.Int 0)) in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      let* &quot;t2&quot; := Instr.MakeInterface (Val.Lit (Lit.String &quot;Hello, World!&quot;)) in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      do* Instr.Store (Register.read &quot;t1&quot;) (Register.read &quot;t2&quot;) in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      let* &quot;t3&quot; := Instr.Slice (Register.read &quot;t0&quot;) None None in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      let* &quot;t4&quot; := Instr.Call (CallKind.Function (fmt.Println [(Register.read &quot;t3&quot;)])) in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      M.Return []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | _ =&gt; M.Thunk (M.EvalBody [])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">with init (α : list Val.t) : M (list Val.t) :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  M.Thunk (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  match α with</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | [] =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    M.Thunk (M.EvalBody [(0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      let* &quot;t0&quot; := Instr.UnOp &quot;*&quot; (Register.read &quot;init$guard&quot;) in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Instr.If (Register.read &quot;t0&quot;) 2 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      do* Instr.Store (Register.read &quot;init$guard&quot;) (Val.Lit (Lit.Bool true)) in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      let* &quot;t1&quot; := Instr.Call (CallKind.Function (fmt.init [])) in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Instr.Jump 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      M.Return []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | _ =&gt; M.Thunk (M.EvalBody [])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end).</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The<!-- --> <code>init</code> function, which is automatically generated by the Go compiler to initialize global variables, does not do much here. It checks whether it was already called or not reading the<!-- --> <code>init$guard</code> variable, and if not, it calls the<!-- --> <code>fmt.init</code> function. The<!-- --> <code>Main</code> function is the one that we are interested in. It allocates a variable to store the string &quot;Hello, World!&quot;, and then calls the<!-- --> <code>fmt.Println</code> function to print it.</p><p>From there, to continue the project we have two possibilities:</p><ol><li>Give actual definitions to each primitive instruction that is used in this example (for now, everything is axiomatized).</li><li>Translate all the transitive dependencies of the hello world program to Coq, and make sure that we can compile everything together.</li></ol><p>For the next step, we choose to follow the second possibility as we are more confident in being able to define the semantics of the instructions, which is purely done on the Coq side, than in being able to use the Go compiler&#x27;s APIs to retrieve the definitions of all the dependencies and related them together.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="conclusion">Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">​</a></h2><p>We have presented the beginning of our journey to translate Go programs to Coq, to build a formal verification tool for Go. The translation type-checks on the few examples we have tried but has no semantics. We will follow by handling the translation of dependencies of a package.</p><p>If you are interested in this project, please contact us at<!-- --> <a href="mailto:contact@formal.land" target="_blank" rel="noopener noreferrer">c<!-- -->o<!-- -->n<!-- -->t<!-- -->a<!-- -->c<!-- -->t<!-- -->@<!-- -->formal<!-- -->.<!-- -->l<!-- -->a<!-- -->n<!-- -->d</a> or go to our <a href="https://github.com/formal-land/coq-of-go-experiment" target="_blank" rel="noopener noreferrer">GitHub repository</a>.</p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_3kfx"><div class="col"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/blog/tags/coq-of-go">coq-of-go</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/blog/tags/go">Go</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/blog/tags/coq">Coq</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/blog/tags/translation">translation</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2024/02/14/experiment-coq-of-hs"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Experiment on translation from Haskell to Coq<!-- --> »</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#first-target" class="table-of-contents__link toc-highlight">First target</a></li><li><a href="#the-start" class="table-of-contents__link toc-highlight">The start</a></li><li><a href="#functions" class="table-of-contents__link toc-highlight">Functions</a></li><li><a href="#type-checking" class="table-of-contents__link toc-highlight">Type-checking</a><ul><li><a href="#representation-of-values" class="table-of-contents__link toc-highlight">Representation of values</a></li><li><a href="#monadic-style" class="table-of-contents__link toc-highlight">Monadic style</a></li></ul></li><li><a href="#next" class="table-of-contents__link toc-highlight">Next</a></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Content</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/company/about">Company</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/company/claims">Claims</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/company/press">Press</a></li></ul></div><div class="col footer__col"><div class="footer__title">Links</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/LandFoobar" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://fr.linkedin.com/company/formal-land" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Linkedin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://t.me/formal_land" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Telegram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.tiktok.com/@formal.land" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>TikTok<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="mailto:contact@formal.land" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Email<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/formal-land" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://gitlab.com/formal-land" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitLab<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://formal-land.gitlab.io/coq-tezos-of-ocaml/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Coq Tezos of OCaml<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Formal Land (Arae SARL) 🐦, Paris<br><em>Formal verification for everyday-life applications 🏇</em><!-- Start of LiveChat (www.livechat.com) code -->
<script>window.__lc=window.__lc||{},window.__lc.license=14938650,function(n,t,c){function i(n){return e._h?e._h.apply(null,n):e._q.push(n)}var e={_q:[],_h:null,_v:"2.0",on:function(){i(["on",c.call(arguments)])},once:function(){i(["once",c.call(arguments)])},off:function(){i(["off",c.call(arguments)])},get:function(){if(!e._h)throw new Error("[LiveChatWidget] You can't use getters before load.");return i(["get",c.call(arguments)])},call:function(){i(["call",c.call(arguments)])},init:function(){var n=t.createElement("script");n.async=!0,n.type="text/javascript",n.src="https://cdn.livechatinc.com/tracking.js",t.head.appendChild(n)}};!n.__lc.asyncInit&&e.init(),n.LiveChatWidget=n.LiveChatWidget||e}(window,document,[].slice)</script>
<noscript><a href="https://www.livechat.com/chat-with/14938650/" rel="nofollow">Chat with us</a>, powered by <a href="https://www.livechat.com/?welcome" rel="noopener nofollow" target="_blank">LiveChat</a></noscript>
<!-- End of LiveChat code --></div></div></div></footer></div>
<script src="/assets/js/runtime~main.b15903ae.js"></script>
<script src="/assets/js/main.eb2a146d.js"></script>
</body>
</html>