<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Formal Land RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Formal Land Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MQLHF4EV4J"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-MQLHF4EV4J",{anonymize_ip:!0})</script><title data-react-helmet="true">Module system | Formal Land</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://formal.land/img/land-512.png"><meta data-react-helmet="true" name="twitter:image" content="https://formal.land/img/land-512.png"><meta data-react-helmet="true" property="og:url" content="https://formal.land/docs/coq-of-ocaml/module-system"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Module system | Formal Land"><meta data-react-helmet="true" name="description" content="To handle the module system of OCaml, the compiler coq-of-ocaml generates either plain Coq modules or dependent records. It never generates Coq functors or module types. You can use coq-of-ocaml to translate modules, module types, functors and first-class modules."><meta data-react-helmet="true" property="og:description" content="To handle the module system of OCaml, the compiler coq-of-ocaml generates either plain Coq modules or dependent records. It never generates Coq functors or module types. You can use coq-of-ocaml to translate modules, module types, functors and first-class modules."><link data-react-helmet="true" rel="icon" href="/img/land-512.png"><link data-react-helmet="true" rel="canonical" href="https://formal.land/docs/coq-of-ocaml/module-system"><link data-react-helmet="true" rel="alternate" href="https://formal.land/docs/coq-of-ocaml/module-system" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://formal.land/docs/coq-of-ocaml/module-system" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.ea466720.css">
<link rel="preload" href="/assets/js/runtime~main.75dc1c71.js" as="script">
<link rel="preload" href="/assets/js/main.d061e8c6.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" style="background-color:#fafbfc;color:#091E42" role="banner"><div class="announcementBarContent_3EUC">ü§ô&nbsp;DM us at <a href="mailto:&#099;&#111;&#110;&#116;&#097;&#099;&#116;&#064;formal&#046;&#108;&#097;&#110;&#100;">&#099;&#111;&#110;&#116;&#097;&#099;&#116;&#064;formal&#046;&#108;&#097;&#110;&#100;</a>&nbsp;ü§ô</div></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/land-512.png" alt="Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/land-512.png" alt="Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Formal Land</b></a><a class="navbar__item navbar__link" href="/docs/company/about">Company</a><a class="navbar__item navbar__link" href="/docs/verification/ocaml">Formal verification</a><a class="navbar__item navbar__link" href="/docs/services/solidity-development">Services</a><a class="navbar__item navbar__link" href="/docs/coq-of-ocaml/introduction">coq-of-ocaml</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/formal-land" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://gitlab.com/formal-land" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitLab<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/docs/company/about">Company</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/docs/verification/ocaml">Formal verification</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/docs/services/ocaml-development">Services</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_2fq0" href="/docs/coq-of-ocaml/introduction">üê´ coq-of-ocaml</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coq-of-ocaml/introduction">What is coq-of-ocaml</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coq-of-ocaml/install">Install</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coq-of-ocaml/run">Run</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coq-of-ocaml/cookbook">Cookbook</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_2fq0" tabindex="0" href="/docs/coq-of-ocaml/ocaml-core">Language</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coq-of-ocaml/ocaml-core">OCaml core</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coq-of-ocaml/type-definitions">Type definitions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/coq-of-ocaml/module-system">Module system</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coq-of-ocaml/gadts">GADTs</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" tabindex="0" href="/docs/coq-of-ocaml/attributes">Options</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" tabindex="0" href="/docs/coq-of-ocaml/examples">More</a></div></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Module system</h1></header><p>To handle the module system of OCaml, the compiler <code>coq-of-ocaml</code> generates either plain Coq modules or dependent records. It never generates Coq functors or module types. You can use <code>coq-of-ocaml</code> to translate modules, module types, functors and first-class modules.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="general-mechanism">General mechanism<a class="hash-link" href="#general-mechanism" title="Direct link to heading">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_31ik" id="example">Example<a class="hash-link" href="#example" title="Direct link to heading">‚Äã</a></h3><p>The following code:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">MyModuleForNamespacing</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> foo x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> x </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> bar </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">COMPARABLE</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sig</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> compare </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">InstanceToUseInFunctors</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> compare </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">String</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">compare</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>is translated to:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Module MyModuleForNamespacing.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Definition foo (x : Z) : Z := Z.add x 1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Definition bar : Z := 12.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End MyModuleForNamespacing.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Module COMPARABLE.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Record signature {t : Set} := {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    t := t;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compare : t -&gt; t -&gt; Z;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Arguments signature : clear implicits.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End COMPARABLE.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Definition InstanceToUseInFunctors :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let t := string in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let compare := Stdlib.String.compare in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  existT (fun _ =&gt; _) tt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      COMPARABLE.compare := compare</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |}.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>We use a plain module for <code>MyModuleForNamespacing</code> as we think it will not be used in functors or first-class modules. We translate the module type <code>COMPARABLE</code> to a record parametrized by <code>t</code> as this type is abstract. The <code>InstanceToUseInFunctors</code> is translated to a dependent record of type <code>COMPARABLE.signature</code> as it may by used as a parameter for a functor for example. We will see how we determine that a module should translates to a record.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="finding-names">Finding names<a class="hash-link" href="#finding-names" title="Direct link to heading">‚Äã</a></h3><p>The heuristic is to represent a module by a dependent record if and only if it has a named signature. The name of the signature is then the name of the record type. Each signature is translated to a record type.</p><p>The OCaml modules are structurally typed while the Coq records are nominally typed. Thus a large part of the conversion effort is dedicated to the naming of signatures. A signature is named by exploring the environment to find a similar signature definition with its name. Two signatures are deemed similar if they share the same list of names of values and sub-modules at top-level. We do not check for type names or values as they could be removed or changed by the use of type substitutions (operators <code>with type t = ...</code> and <code>with type t := ...</code>). We only check top-level names for efficiency reasons, and because exploring sub-modules resulted in errors in some cases.</p><p>We generate an error message when multiple names are found for a signature. For example with:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">S1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sig</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> v </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">S2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sig</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> v </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> M </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> v </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;hi&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>the module <code>M</code> could have the signatures <code>S1</code> or <code>S2</code> as we only look at the value names, so we output the error:</p><div class="codeBlockContainer_K1bP language-text theme-code-block"><div class="codeBlockContent_hGly text"><pre tabindex="0" class="prism-code language-text codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">   7 | end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   8 | </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;  9 | module M = struct</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  10 |   let v = &quot;hi&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  11 | end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  12 | </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">It is unclear which name has this signature. At least two similar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signatures found, namely:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">S2, S1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">We were looking for a module signature name for the following shape:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ v ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(a shape is a list of names of values and sub-modules)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">We use the concept of shape to find the name of a signature for Coq.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>To discriminate between two similar signatures, you can add a dummy tag field. With:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">S1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sig</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> this_is_S1 </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> unit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> v </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">S2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sig</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> this_is_S2 </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> unit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> v </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> M </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> this_is_S1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> v </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;hi&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><code>coq-of-ocaml</code> generates without errors:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Module S1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Record signature := {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    this_is_S1 : unit;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    v : string;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End S1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Module S2.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Record signature := {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    this_is_S2 : unit;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    v : Z;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End S2.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Definition M :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let this_is_S1 := tt in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let v := &quot;hi&quot; in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  existT (fun _ =&gt; _) tt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      S1.this_is_S1 := this_is_S1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      S1.v := v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |}.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>If no signatures are found, the module <code>M</code> is translated to a plain Coq module:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> S </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sig</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> v </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> M </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> not_v </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;hi&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>generates:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Module S.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Record signature := {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    v : string;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End S.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Module M.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Definition not_v : string := &quot;hi&quot;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End M.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="bundled-vs-unbundled">Bundled vs unbundled<a class="hash-link" href="#bundled-vs-unbundled" title="Direct link to heading">‚Äã</a></h3><p>In OCaml modules may have some abstract types. In Coq we represent abstract types as type parameters for the records of the signatures. For module values, we instantiate known abstract types and use existential types for unknown abstract types. We always use a single existential <code>{... &amp; ...}</code> on the tuple of unknown types. If all types are known, we still use an existential on the empty tuple for uniformity.</p><p>We say that:</p><ul><li>signatures are always unbundled (with universal types);</li><li>module are always bundled (with existential types).</li></ul><h2 class="anchor anchorWithStickyNavbar_31ik" id="signatures">Signatures<a class="hash-link" href="#signatures" title="Direct link to heading">‚Äã</a></h2><p>Signatures can contain a mix of:</p><ul><li>abstract types (constant or polymorphic);</li><li>type definitions as synonyms;</li><li>values;</li><li>sub-modules.</li></ul><p>A complex example is the following:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">SubS</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sig</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> v </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> size</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> n </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> size</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> S </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sig</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token plain"> t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> int_t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> int t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> numbers </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> int_t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Sub</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">SubS</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> int_t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> n </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Sub</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">size</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>which gets translated to:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Module SubS.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Record signature {t size : Set} := {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    t := t;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    v : t;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    size := size;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    n : size;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Arguments signature : clear implicits.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End SubS.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Module S.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Record signature {t : Set -&gt; Set} {Sub_size : Set} := {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    t := t;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int_t := t Z;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    numbers : int_t;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Sub : SubS.signature int_t Sub_size;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    n : Sub.(SubS.size);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Arguments signature : clear implicits.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End S.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The signature <code>SubS</code> has two abstract types <code>t</code> and <code>size</code>. We define two synonym record fields <code>t := t</code> and <code>size := size</code> for uniform access.</p><p>The signature <code>S</code> is parametrized by its abstract type <code>t</code> and the abstract type <code>Sub_size</code> of its sub-module <code>Sub</code>. The abstract type <code>t</code> is polymorphic and of type <code>Set -&gt; Set</code>. The type synonym <code>int_t</code> is defined as a synonym record field. The sub-module <code>Sub</code> is a field of the record <code>S.signature</code> and of type the record <code>SubS.signature</code>. Its type parameter <code>t</code> is instantiated by <code>int_t</code>. Note that sub-module values appear as <em>unbundled</em> records. This is the only case where module values are unbundled. We made this choice because the abstract types of the sub-module <code>Sub</code> may be instantiated later as in:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">S </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Sub</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> int</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Finally, a signature field such as <code>n</code> can refer to a type defined in the sub-module <code>Sub</code>.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="modules">Modules<a class="hash-link" href="#modules" title="Direct link to heading">‚Äã</a></h2><p>The modules with a named signature are represented as bundled dependent records. The abstract types are generally known at the moment of the definition, but may still be hidden by casting. For example, the following code:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Source</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sig</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> x </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">M_NoCast</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">M_WithCast</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Source</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>will generate:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Module Source.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Record signature {t : Set} := {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    t := t;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x : t;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Arguments signature : clear implicits.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End Source.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Definition M_NoCast :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let t := Z in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let x := 12 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  existT (fun _ =&gt; _) tt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Source.x := x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |}.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Definition M_WithCast :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let t := Z in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let x := 12 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  existT _ _</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Source.x := x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |}.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The module <code>M_NoCast</code> has no existential variables while the module <code>M_WithCast</code> has one due to the cast to the <code>Source</code> signature. This is visible in the use a <code>_</code> to ask Coq to infer the value of this type, in place of a <code>tt</code> to represent the absence of existential variables.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="existential-tuples">Existential tuples<a class="hash-link" href="#existential-tuples" title="Direct link to heading">‚Äã</a></h3><p>In the presence of several existential variables we use tuples of types with primitive projections. Primitive projections help Coq to infer missing values in generated terms, so that we do not need to annotate too much module expressions. These tuples are a variant of the tuples of the standard library. We use the following notations:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">[T1 * T2 * ... Tn] (* the type of a tuple *)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[v1, v2, ..., vn]  (* the value of tuple *)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>A tuple of <em>n</em> values is encoded as <em>n-1</em> nested tuples of two values.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="projections">Projections<a class="hash-link" href="#projections" title="Direct link to heading">‚Äã</a></h3><p>As modules are always bundled (unless in the case of sub-modules in signatures), we introduce a notation for the Coq projection <code>projT2</code>:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">(|bundled_record|)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Thus projections from modules encoded as a record:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">M_WithCast</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">x</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>typically have this shape in Coq:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Definition x : (|M_WithCast|).(Source.t) := (|M_WithCast|).(Source.x).</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>We did not add a notation for doing both the projection and the field access, as this would mess up with the inference for implicit variables in polymorphic fields.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="include">Include<a class="hash-link" href="#include" title="Direct link to heading">‚Äã</a></h2><p>Includes, either in signatures or modules, are generally inlined. For example, with signatures:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">COMPARABLE</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sig</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> compare </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> S </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sig</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">include</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">COMPARABLE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> equal </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> max </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> min </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>generates:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Module COMPARABLE.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Record signature {t : Set} := {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    t := t;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compare : t -&gt; t -&gt; Z;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Arguments signature : clear implicits.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End COMPARABLE.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Module S.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Record signature {t : Set} := {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    t := t;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compare : t -&gt; t -&gt; Z;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    op_eq : t -&gt; t -&gt; bool;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    op_ltgt : t -&gt; t -&gt; bool;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    op_lt : t -&gt; t -&gt; bool;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    op_lteq : t -&gt; t -&gt; bool;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    op_gteq : t -&gt; t -&gt; bool;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    op_gt : t -&gt; t -&gt; bool;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    equal : t -&gt; t -&gt; bool;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    max : t -&gt; t -&gt; t;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    min : t -&gt; t -&gt; t;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Arguments signature : clear implicits.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End S.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Due to duplications, <code>coq-of-ocaml</code> may generate Coq terms which are larger than the corresponding OCaml code. If you want to keep a generated Coq without duplications, we recommend you to use sub-modules rather than includes.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="functors">Functors<a class="hash-link" href="#functors" title="Direct link to heading">‚Äã</a></h2><p>We represent functors as functions over bounded records. Here is the example of a functor declaration:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Make</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">P </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">COMPARABLE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">S </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> P</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>generating:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Parameter Make :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  forall (P : {t : _ &amp; COMPARABLE.signature t}),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {_ : unit &amp; S.signature (|P|).(COMPARABLE.t)}.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>We see that the return type of <code>Make</code> is a dependent type depending on the value of the field <code>COMPARABLE.t</code> of <code>P</code>. A functor may also return another functor.</p><p>Here is an example of functor definition and application:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Source</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sig</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> x </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Target</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sig</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> y </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> F </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">X </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Source</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Target</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> X</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> X</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> X</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> M </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Source</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> N </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> F </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">M</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>generating:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Module Source.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Record signature {t : Set} := {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    t := t;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x : t;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Arguments signature : clear implicits.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End Source.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Module Target.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Record signature {t : Set} := {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    t := t;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y : t;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Arguments signature : clear implicits.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End Target.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Definition F :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fun (X : {t : _ &amp; Source.signature t}) =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (let t := (|X|).(Source.t) in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let y := (|X|).(Source.x) in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    existT (fun _ =&gt; _) tt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Target.y := y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      |} : {_ : unit &amp; Target.signature (|X|).(Source.t)}).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Definition M :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let t := Z in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let x := 12 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  existT _ _</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Source.x := x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |}.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Definition N :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  F</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (existT _ _</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Source.x := (|M|).(Source.x)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      |}).</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Applications of functors are represented by standard function applications. We cast the module parameter to make sure he has the correct record type. We cast records by re-creating them with the right field names.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="first-class-modules">First-class modules<a class="hash-link" href="#first-class-modules" title="Direct link to heading">‚Äã</a></h2><p>First-class modules are modules which appear as values in OCaml. The encoding to dependent records provides a perfect way to represent them in Coq. Here is an example from the Tezos source code:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Boxed_set</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sig</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> elt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> elt_ty </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> elt comparable_ty</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">OPS</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> S</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module variable" style="color:#36acaa">SET</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> elt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> elt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> boxed </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">OPS</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> size </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token type-variable function" style="color:#d73a49">&#x27;elt</span><span class="token plain"> set </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Boxed_set</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> elt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token type-variable function" style="color:#d73a49">&#x27;elt</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> set_mem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> elt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> elt </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> elt set </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> v </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Box</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token module variable" style="color:#36acaa">Box</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module variable" style="color:#36acaa">OPS</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mem v </span><span class="token module variable" style="color:#36acaa">Box</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">boxed</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>generates:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Module Boxed_set.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Record signature {elt OPS_t : Set} := {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    elt := elt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    elt_ty : comparable_ty elt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    OPS : S.SET.signature elt OPS_t;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    boxed : OPS.(S.SET.t);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    size : Z;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Arguments signature : clear implicits.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End Boxed_set.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Definition set (elt : Set) := {OPS_t : _ &amp; Boxed_set.signature elt OPS_t}.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Definition set_mem {elt : Set} (v : elt) (Box : set elt) : bool :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (|Box|).(Boxed_set.OPS).(S.SET.mem) v (|Box|).(Boxed_set.boxed).</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Many things are happening here, but the main thing to know is that we do not need to represent the OCaml lifts &quot;module to value&quot; or &quot;value to module&quot; since dependent records are already values in Coq.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/coq-of-ocaml/type-definitions"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Type definitions</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/coq-of-ocaml/gadts"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">GADTs</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#general-mechanism" class="table-of-contents__link toc-highlight">General mechanism</a><ul><li><a href="#example" class="table-of-contents__link toc-highlight">Example</a></li><li><a href="#finding-names" class="table-of-contents__link toc-highlight">Finding names</a></li><li><a href="#bundled-vs-unbundled" class="table-of-contents__link toc-highlight">Bundled vs unbundled</a></li></ul></li><li><a href="#signatures" class="table-of-contents__link toc-highlight">Signatures</a></li><li><a href="#modules" class="table-of-contents__link toc-highlight">Modules</a><ul><li><a href="#existential-tuples" class="table-of-contents__link toc-highlight">Existential tuples</a></li><li><a href="#projections" class="table-of-contents__link toc-highlight">Projections</a></li></ul></li><li><a href="#include" class="table-of-contents__link toc-highlight">Include</a></li><li><a href="#functors" class="table-of-contents__link toc-highlight">Functors</a></li><li><a href="#first-class-modules" class="table-of-contents__link toc-highlight">First-class modules</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Content</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/company/about">Company</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/company/claims">Claims</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/company/press">Press</a></li></ul></div><div class="col footer__col"><div class="footer__title">Links</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/LandFoobar" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://fr.linkedin.com/company/formal-land" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Linkedin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://t.me/formal_land" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Telegram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="mailto:contact@formal.land" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Email<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/formal-land" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://gitlab.com/formal-land" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitLab<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://formal-land.gitlab.io/coq-tezos-of-ocaml/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Coq Tezos of OCaml<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2023 Formal Land (Arae SARL) üê¶, Paris<br><em>Unbreakable safety with formal verification üèá</em><!-- Start of LiveChat (www.livechat.com) code -->
<script>window.__lc=window.__lc||{},window.__lc.license=14938650,function(n,t,c){function i(n){return e._h?e._h.apply(null,n):e._q.push(n)}var e={_q:[],_h:null,_v:"2.0",on:function(){i(["on",c.call(arguments)])},once:function(){i(["once",c.call(arguments)])},off:function(){i(["off",c.call(arguments)])},get:function(){if(!e._h)throw new Error("[LiveChatWidget] You can't use getters before load.");return i(["get",c.call(arguments)])},call:function(){i(["call",c.call(arguments)])},init:function(){var n=t.createElement("script");n.async=!0,n.type="text/javascript",n.src="https://cdn.livechatinc.com/tracking.js",t.head.appendChild(n)}};!n.__lc.asyncInit&&e.init(),n.LiveChatWidget=n.LiveChatWidget||e}(window,document,[].slice)</script>
<noscript><a href="https://www.livechat.com/chat-with/14938650/" rel="nofollow">Chat with us</a>, powered by <a href="https://www.livechat.com/?welcome" rel="noopener nofollow" target="_blank">LiveChat</a></noscript>
<!-- End of LiveChat code --></div></div></div></footer></div>
<script src="/assets/js/runtime~main.75dc1c71.js"></script>
<script src="/assets/js/main.d061e8c6.js"></script>
</body>
</html>