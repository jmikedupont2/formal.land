<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Formal Land RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Formal Land Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MQLHF4EV4J"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-MQLHF4EV4J",{anonymize_ip:!0})</script><title data-react-helmet="true">Attributes | Formal Land</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://formal.land/img/land-512.png"><meta data-react-helmet="true" name="twitter:image" content="https://formal.land/img/land-512.png"><meta data-react-helmet="true" property="og:url" content="https://formal.land/docs/coq-of-ocaml/attributes"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Attributes | Formal Land"><meta data-react-helmet="true" name="description" content="We present the attributes which we can use with coq-of-ocaml. See the attributes documentation of OCaml for general information about the attributes mechanism. Note that the OCaml attributes do not change the behavior of a program. There are there to help developer tools."><meta data-react-helmet="true" property="og:description" content="We present the attributes which we can use with coq-of-ocaml. See the attributes documentation of OCaml for general information about the attributes mechanism. Note that the OCaml attributes do not change the behavior of a program. There are there to help developer tools."><link data-react-helmet="true" rel="icon" href="/img/land-512.png"><link data-react-helmet="true" rel="canonical" href="https://formal.land/docs/coq-of-ocaml/attributes"><link data-react-helmet="true" rel="alternate" href="https://formal.land/docs/coq-of-ocaml/attributes" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://formal.land/docs/coq-of-ocaml/attributes" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.4217a645.css">
<link rel="preload" href="/assets/js/runtime~main.a9329436.js" as="script">
<link rel="preload" href="/assets/js/main.d5dfeb25.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" style="background-color:#fafbfc;color:#091E42" role="banner"><div class="announcementBarContent_3EUC">We are hiring! 📣 See our <a href="/docs/company/careers">job offers 🌷</a>.</div></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/land-512.png" alt="Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/land-512.png" alt="Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Formal Land</b></a><a class="navbar__item navbar__link" href="/docs/company/intro">Company</a><a class="navbar__item navbar__link" href="/docs/coq-of-ocaml/introduction">coq-of-ocaml</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/foobar-land" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">🌜</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">🌞</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/docs/company/intro">Company</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_2fq0" href="/docs/coq-of-ocaml/introduction">coq-of-ocaml</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coq-of-ocaml/introduction">What is coq-of-ocaml</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coq-of-ocaml/install">Install</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coq-of-ocaml/run">Run</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coq-of-ocaml/cookbook">Cookbook</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" tabindex="0" href="/docs/coq-of-ocaml/ocaml-core">Language</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_2fq0" tabindex="0" href="/docs/coq-of-ocaml/attributes">Options</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/coq-of-ocaml/attributes">Attributes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coq-of-ocaml/configuration">Configuration</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" tabindex="0" href="/docs/coq-of-ocaml/examples">More</a></div></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Attributes</h1></header><p>We present the attributes which we can use with <code>coq-of-ocaml</code>. See the <a href="https://caml.inria.fr/pub/docs/manual-ocaml/attributes.html" target="_blank" rel="noopener noreferrer">attributes documentation</a> of OCaml for general information about the attributes mechanism. Note that the OCaml attributes do not change the behavior of a program. There are there to help developer tools.</p><p>We prefix all the attributes of <code>coq-of-ocaml</code> by <code>coq_</code>. According to the OCaml syntax, depending on the context, you may use a single <code>@</code> or a double <code>@@</code>.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="coq_axiom_with_reason">coq_axiom_with_reason<a class="hash-link" href="#coq_axiom_with_reason" title="Direct link to heading">​</a></h2><p>When we cannot import the definition of a value, we can use the <code>[@coq_axiom_with_reason]</code> attribute to transform it to a Coq axiom. For example:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">@</span><span class="token plain">coq_axiom_with_reason </span><span class="token string" style="color:#e3116c">&quot;mutable state&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> function_hard_to_translate_to_coq </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> n </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ref </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    n </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain">n </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">!</span><span class="token plain">n</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>is translated to:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Definition function_hard_to_translate_to_coq : unit -&gt; Z := axiom.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Note that we must give a reason for the use of <code>[@coq_axiom_with_reason]</code> in a string parameter. We define the <code>axiom</code> value in the <code>coq-of-ocaml</code>&#x27;s Coq library. The definition of <code>axiom</code> is:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Axiom axiom : forall {A : Set}, A.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="coq_cast">coq_cast<a class="hash-link" href="#coq_cast" title="Direct link to heading">​</a></h2><p>With the attribute <code>[@coq_cast]</code> we can force the type in Coq of an arbitrary OCaml expression using the following axiom:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Axiom cast : forall {A : Set} (B : Set), A -&gt; B.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>For example, we translate:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">_</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Int</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> int t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> f </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">kind </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> a t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> int </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">match</span><span class="token plain"> kind </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Int</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">@</span><span class="token plain">coq_cast</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>to:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Inductive t : Set :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Int : t.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Definition f {a : Set} (kind : t) (x : a) : int :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let &#x27;Int := kind in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Z.add (cast int x) 1.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Thanks to the <code>cast</code> axiom, we can get the information in Coq that <code>x</code> is of type <code>int</code>. Without this axiom the example would not work. Indeed, we do not track the type equations generated by the <a href="https://caml.inria.fr/pub/docs/manual-ocaml/gadts.html" target="_blank" rel="noopener noreferrer">GADTs</a> so <code>x</code> would be considered of type <code>a</code>. Without the cast, the Coq code:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Definition f {a : Set} (kind : t) (x : a) : int :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let &#x27;Int := kind in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Z.add x 1.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>generates the error:</p><div class="codeBlockContainer_K1bP language-text theme-code-block"><div class="codeBlockContent_hGly text"><pre tabindex="0" class="prism-code language-text codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&gt;   Z.add x 1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;         ^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Error:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">In environment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">a : Set</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind : t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x : a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The term &quot;x&quot; has type &quot;a&quot; while it is expected to have type &quot;Z&quot;.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="coq_force_gadt">coq_force_gadt<a class="hash-link" href="#coq_force_gadt" title="Direct link to heading">​</a></h2><p>The <code>[@coq_force_gadt]</code> attribute forces a type definition to be considered as a GADT during the translation to Coq. In particular, it forces the translation to erase the type parameters. For example:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token plain"> standard_list </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">SNil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">SCons</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> </span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token plain"> standard_list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token plain"> gadt_list </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">GNil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">GCons</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> </span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token plain"> gadt_list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">@@</span><span class="token plain">coq_force_gadt</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>generates:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Inductive standard_list (a : Set) : Set :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| SNil : standard_list a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| SCons : a -&gt; standard_list a -&gt; standard_list a.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Arguments SNil {_}.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Arguments SCons {_}.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Inductive gadt_list : Set :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| GNil : gadt_list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| GCons : forall {a : Set}, a -&gt; gadt_list -&gt; gadt_list.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>One possible reason to force a type to be a GADT is to make sure that all the inductive types in a mutually recursive type definition have the same (zero) arity, as it is expected by Coq.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="coq_grab_existentials">coq_grab_existentials<a class="hash-link" href="#coq_grab_existentials" title="Direct link to heading">​</a></h2><p>When translating terms that mentions existential variables it might be necessary to make that existential variable explicit.
To achieve this we use the <code>[@coq_grab_existentials]</code> attribute. Here is an example:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> wrap1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Cw1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token type-variable function" style="color:#d73a49">&#x27;b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> wrap1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> wrap2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Cw2</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> wrap2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> w2_of_w1 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">w </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> wrap2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> wrap1  </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">match</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">@</span><span class="token plain">coq_grab_existentials</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">w </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Cw2</span><span class="token plain"> f </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token module variable" style="color:#36acaa">Cw1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> y </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> f y</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Notice that the type of <code>inj</code> is <code>&#x27;a -&gt; &#x27;a</code> for some existential variable <code>&#x27;a</code>.
Since <code>coq-of-ocaml</code> always generates fully anotated code, we need to explicitely
name <code>&#x27;a</code> in order to properly anotate the type of <code>y</code> in the body of <code>Cw1</code>.
This gives us the following translation:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Inductive wrap1 : Set :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Cw1 : forall {a b : Set}, (a -&gt; b) -&gt; wrap1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Inductive wrap2 : Set :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Cw2 : forall {a : Set}, (a -&gt; a) -&gt; wrap2.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Definition w2_of_w1 (w : wrap2) : wrap1 :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let &#x27;Cw2 f := w in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let &#x27;existT _ __Cw2_&#x27;a f as exi :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    existT (A := Set) (fun __Cw2_&#x27;a =&gt; __Cw2_&#x27;a -&gt; __Cw2_&#x27;a) _ f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      let fst := projT1 exi in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      let __Cw2_&#x27;a := fst in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      wrap1 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Cw1 (fun (y : __Cw2_&#x27;a) =&gt; f y).</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In the coq side we use an <code>existT</code> to grab these existential variables.  The key
here is that this allows us to explicitely name <code>&#x27;a</code> as <code>__Cw2_&#x27;a</code>. </p><p>The return clause is used to bind this new name in the return type of the term
that is being built, in this example it wouldn&#x27;t be necessary but we generate
the same code for a simpler boilerplate.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="coq_implicit">coq_implicit<a class="hash-link" href="#coq_implicit" title="Direct link to heading">​</a></h2><p>The <code>[@coq_implicit &quot;(A := ...)&quot;]</code> attribute adds an arbitrary annotation on an OCaml identifier or constructor. We typically use this attribute to help Coq to infer implicit types where there is an ambiguity:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> forget x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> u </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> forget </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>generates the following Coq code:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Definition forget {A : Set} (x : A) : unit := tt.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Definition u : unit := forget nil.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>which fails to compile due to the error:</p><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&gt; Definition u : unit := forget nil.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;                               ^^^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Error: Cannot infer the implicit parameter A of nil whose type is &quot;Set&quot;.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Indeed, the type parameter of this empty list does not matter as it is dropped by the <code>forget</code> function. We can force it to an arbitrary value like <code>unit</code>:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> u </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> forget </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">@</span><span class="token plain">coq_implicit </span><span class="token string" style="color:#e3116c">&quot;(A := unit)&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>so that the generated Coq code compiles:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Definition u : unit := forget (nil (A := unit)).</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="coq_match_gadt">coq_match_gadt<a class="hash-link" href="#coq_match_gadt" title="Direct link to heading">​</a></h2><p>The <code>[@coq_match_gadt]</code> attribute adds type annotations for the pattern variables in a <code>match</code>. We force the type annotations to be valid using axioms (dynamic casts). For example:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token plain"> int_or_bool </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Int</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> int int_or_bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Bool</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> bool int_or_bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> to_int </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">kind </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> a int_or_bool</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> int </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">match</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">@</span><span class="token plain">coq_match_gadt</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">kind</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token module variable" style="color:#36acaa">Int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token module variable" style="color:#36acaa">Bool</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> bool</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> x </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>translates to:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Inductive int_or_bool : Set :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Int : int_or_bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Bool : int_or_bool.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Definition to_int {a : Set} (kind : int_or_bool) (x : a) : Z :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  match (kind, x) with</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | (Int, _ as x) =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let x := cast Z x in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | (Bool, _ as x) =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let x := cast bool x in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if x then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The <code>cast</code> operator is a dynamic cast defined by:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Axiom cast : forall {A : Set} (B : Set), A -&gt; B.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Note that without the <code>[@coq_match_gadt]</code> attribute this would generate:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Definition to_int {a : Set} (kind : int_or_bool) (x : a) : Z :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  match (kind, x) with</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | (Int, _ as x) =&gt; x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | (Bool, _ as x) =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if x then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>which is ill-typed in Coq.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="coq_match_gadt_with_result">coq_match_gadt_with_result<a class="hash-link" href="#coq_match_gadt_with_result" title="Direct link to heading">​</a></h2><p>The attribute <code>[@coq_match_gadt_with_result]</code> is similar to <code>[@coq_match_gadt]</code> and also adds a cast for the result of each <code>match</code> branch. Here is an example where it is useful:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> incr_if_int </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">kind </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> a int_or_bool</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">match</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">@</span><span class="token plain">coq_match_gadt_with_result</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">kind</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token module variable" style="color:#36acaa">Int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> x </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token module variable" style="color:#36acaa">Bool</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> bool</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> x </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>generates in Coq:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Definition incr_if_int {a : Set} (kind : int_or_bool) (x : a) : a :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  match (kind, x) with</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | (Int, _ as x) =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let x := cast Z x in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cast a (Z.add x 1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | (Bool, _ as x) =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let x := cast bool x in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cast a x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="coq_match_with_default">coq_match_with_default<a class="hash-link" href="#coq_match_with_default" title="Direct link to heading">​</a></h2><p>The <code>[@coq_match_with_default]</code> adds a default branch for <code>match</code> which are syntactically incomplete. For example, when we annotate the following code:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> incr_int </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">kind_and_value </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> int int_or_bool </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> int </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">match</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">@</span><span class="token plain">coq_match_with_default</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> kind_and_value </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token module variable" style="color:#36acaa">Int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> x </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>we generate the following valid Coq code:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Definition incr_int (kind_and_value : int_or_bool * Z) : Z :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  match kind_and_value with</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | (Int, x) =&gt; Z.add x 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | _ =&gt; unreachable_gadt_branch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>even if the <code>match</code> is syntactically incomplete due to the GADT&#x27;s constraints. We define <code>unreachable_gadt_branch</code> as an axiom by:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Axiom unreachable_gadt_branch : forall {A : Set}, A.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>We can combine this attribute with <code>[@coq_match_gadt]</code> or <code>[@coq_match_gadt_with_result]</code> if needed.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="coq_mutual_as_notation">coq_mutual_as_notation<a class="hash-link" href="#coq_mutual_as_notation" title="Direct link to heading">​</a></h2><p>The attribute <code>[@coq_mutual_as_notation]</code> makes the definition of a mutually recursive function a notation. For example, we transform the following OCaml code:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rec</span><span class="token plain"> double_list l </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">match</span><span class="token plain"> l </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> l</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> n </span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> l </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> double n </span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> double_list l</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">and</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">@</span><span class="token plain">coq_mutual_as_notation</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> double n </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> n</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>to:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Reserved Notation &quot;&#x27;double&quot;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Fixpoint double_list (l : list int) : list int :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let double := &#x27;double in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  match l with</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | [] =&gt; l</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | cons n l =&gt; cons (double n) (double_list l)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">where &quot;&#x27;double&quot; := (fun (n : int) =&gt; Z.mul 2 n).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Definition double := &#x27;double.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Without this attribute, we would generate a mutually recursive definition:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Fixpoint double_list (l : list int) : list int :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  match l with</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | [] =&gt; l</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | cons n l =&gt; cons (double n) (double_list l)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">with double (n : int) : int := Z.mul 2 n.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>which is rejected by the type-checker of Coq:</p><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Error:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Recursive definition of double_list is ill-formed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">In environment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">double_list : list int -&gt; list int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">double : int -&gt; int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">l : list int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">n : int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">l0 : list int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Recursive call to double has principal argument equal to </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;n&quot; instead of &quot;l0&quot;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Recursive definition is:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;fun l : list int =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> match l with</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> | [] =&gt; l</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> | n :: l0 =&gt; double n :: double_list l0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> end&quot;.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>For recursive notations, you can combine this attribute with <code>@coq_struct</code> to tell <code>coq-of-ocaml</code> to generate a recursive notation. For example, we transform:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token plain"> tree </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Leaf</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> </span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Node</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> </span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token plain"> tree list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rec</span><span class="token plain"> sum </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> int tree</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">match</span><span class="token plain"> t </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Leaf</span><span class="token plain"> n </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Node</span><span class="token plain"> ts </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> sums ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">and</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">@</span><span class="token plain">coq_mutual_as_notation</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">@</span><span class="token plain">coq_struct </span><span class="token string" style="color:#e3116c">&quot;ts&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> sums </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ts </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> int tree list</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">match</span><span class="token plain"> ts </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> t </span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ts </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> sum t </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> sums ts</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>to:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Reserved Notation &quot;&#x27;sums&quot;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Fixpoint sum (t : tree int) : int :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let sums := &#x27;sums in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  match t with</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Leaf n =&gt; n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Node ts =&gt; sums ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">where &quot;&#x27;sums&quot; :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (fix sums (ts : list (tree int)) {struct ts} : int :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match ts with</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | [] =&gt; 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | cons t ts =&gt; Z.add (sum t) (sums ts)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Definition sums := &#x27;sums.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>using the keyword <code>fix</code> for the defintion of <code>sums</code>. In this example too, the type-checker of Coq would reject the definition without a notation.</p><blockquote><p>In the proofs, whenever the definition of <code>sums</code> appears unfolded, you can run the tactic <code>fold sums</code> to hide it.</p></blockquote><h2 class="anchor anchorWithStickyNavbar_31ik" id="coq_phantom">coq_phantom<a class="hash-link" href="#coq_phantom" title="Direct link to heading">​</a></h2><p>When it can, <code>coq-of-ocaml</code> detects phantom types and remove their type annotations. For example, we translate the following OCaml code:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token plain"> num </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> even </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Even</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> two </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> even num </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>to:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Definition num : Set := Z.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Inductive even : Set :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Even : even.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Definition two : num := 2.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The reason is that phantom types may generate ambiguities during type inference in Coq.</p><p>The <code>[@coq_phantom]</code> attribute forces <code>coq-of-ocaml</code> to consider a type as phantom. This can be useful for abstract types in <code>.mli</code> files, since their definition is not reachable. For example:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token plain"> num</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>translates to:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Parameter num : forall (a : Set), Set.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>but:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token plain"> num</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">@@</span><span class="token plain">coq_phantom</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>generates:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Parameter num : Set.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="coq_plain_module">coq_plain_module<a class="hash-link" href="#coq_plain_module" title="Direct link to heading">​</a></h2><p>We may prefer to translate a module to a plain Coq module rather than a record. The <code>[@coq_plain_module]</code> attribute requires a module to be translated as a plain Coq module. For example:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> T </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sig</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> v </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> M </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> v </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>translates to:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Module T.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Record signature {t : Set} : Set := {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    t := t;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    v : t;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End T.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Definition M :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let t : Set := int in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let v := 12 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  existT (A := unit) (fun _ =&gt; _) tt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      T.v := v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |}.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>With the <code>[@coq_plain_module]</code> attribute we translate:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> T </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sig</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> v </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">module</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">@</span><span class="token plain">coq_plain_module</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> M </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> v </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>to:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Module T.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Record signature {t : Set} : Set := {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    t := t;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    v : t;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End T.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Module M.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Definition t : Set := int.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Definition v : int := 12.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End M.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="coq_precise_signature">coq_precise_signature<a class="hash-link" href="#coq_precise_signature" title="Direct link to heading">​</a></h2><p>In order to distinguish between two signatures with the same value names, we can add the <code>[@coq_precise_signature]</code> attribute. For example, we can translate:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Sig1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sig</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> f </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">@@</span><span class="token plain">coq_precise_signature</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Sig2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sig</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> f </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> t list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">@@</span><span class="token plain">coq_precise_signature</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">M1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Sig1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> f n m </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> m</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">M2</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Sig2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> f n </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>to:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Module Sig1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Record signature {t : Set} : Set := {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    t := t;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    f : t -&gt; t -&gt; t * t;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End Sig1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Module Sig2.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Record signature {t : Set} : Set := {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    t := t;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    f : t -&gt; list t;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End Sig2.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Module M1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Definition t : Set := int.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Definition f {A B : Set} (n : A) (m : B) : A * B := (n, m).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Definition module :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    existT (A := Set) _ t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Sig1.f := f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      |}.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End M1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Definition M1 := M1.module.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Module M2.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Definition t : Set := int.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Definition f {A B : Set} (n : A) : list B := nil.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Definition module :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    existT (A := Set) _ t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Sig2.f := f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      |}.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End M2.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Definition M2 := M2.module.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Here we can distinguish between the signature <code>Sig1</code> and <code>Sig2</code> thanks to the type shape of <code>f</code>. Without this attribute, we would get the following error message:</p><div class="codeBlockContainer_K1bP language-text theme-code-block"><div class="codeBlockContent_hGly text"><pre tabindex="0" class="prism-code language-text codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">--- tests/precise_signature.ml:13:1 ----------------------------------------------- module (1/2) ---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  11 | end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  12 | </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; 13 | module M1 : Sig1 = struct</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; 14 |   type t = int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; 15 | </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; 16 |   let f n m = (n, m)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; 17 | end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  18 | </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  19 | module M2 : Sig2 = struct</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  20 |   type t = int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">It is unclear which name this signature has. At least two similar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signatures found, namely:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* Sig1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* Sig2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">We were looking for a module signature name for the following shape:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ f ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(a shape is a list of names of values and sub-modules)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">We use the concept of shape to find the name of a signature for Coq.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Indeed, by default, we only compare signatures based on the names of their fields. With the <code>[@coq_precise_signature]</code> we also use a heuristic to distinguish the types of the values.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="coq_struct">coq_struct<a class="hash-link" href="#coq_struct" title="Direct link to heading">​</a></h2><p>For recursive definitions, we can force the name of the parameter on which we do structural recursion using the attribute <code>[@coq_struct &quot;name&quot;]</code>. This has the same effect as the <code>{struct name}</code> keyword in Coq. For example, we translate:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">@</span><span class="token plain">coq_struct </span><span class="token string" style="color:#e3116c">&quot;accumulator&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rec</span><span class="token plain"> length l accumulator </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">match</span><span class="token plain"> l </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> accumulator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">_</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> l </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> length l </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">accumulator </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>to:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Fixpoint length {A : Set} (l : list A) (accumulator : Z) {struct accumulator}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  : Z :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  match l with</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | [] =&gt; accumulator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | cons _ l =&gt; length l (Z.add accumulator 1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>which is invalid in Coq as the decreasing argument is <code>l</code>.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="coq_tag_gadt">coq_tag_gadt<a class="hash-link" href="#coq_tag_gadt" title="Direct link to heading">​</a></h2><p>We use this tag in order to generate GADTs with a closer semantics to OCaml. Using this tag we translate the following code:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token plain"> term </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">T_Int</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> int </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> int term</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">T_String</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> string </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> string term</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">T_Sum</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> int term </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> int term </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> int term</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">@@</span><span class="token plain">coq_tag_gadt</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>to:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Inductive term : vtag -&gt; Set :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| T_Int : int -&gt; term int_tag</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| T_String : string -&gt; term string_tag</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| T_Sum : term int_tag -&gt; term int_tag -&gt; term int_tag.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>To see its usefulness translating impossible branches without extra axioms check <code>coq_tagged_match</code></p><h2 class="anchor anchorWithStickyNavbar_31ik" id="coq_tagged_match">coq_tagged_match<a class="hash-link" href="#coq_tagged_match" title="Direct link to heading">​</a></h2><p>With the <code>coq_tag_gadt</code> attribute we can translate OCaml code closer to its actual semantics. This allows us to translate pattern matches with impossible branches without the use of axioms. For example:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token plain"> term </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Int</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> int </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> int term</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">String</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> string </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> string term</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Sum</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> int term </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> int term </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> int term</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">@@</span><span class="token plain">coq_tag_gadt</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rec</span><span class="token plain"> get_int </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> int term</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> int </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">match</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">@</span><span class="token plain">coq_tagged_match</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">@</span><span class="token plain">coq_match_with_default</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> e </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Int</span><span class="token plain"> n </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Sum</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> e2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> get_int e1 </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> get_int e2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Will be translated to:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Inductive term : vtag -&gt; Set :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Int : int -&gt; term int_tag</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| String : string -&gt; term string_tag</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Sum : term int_tag -&gt; term int_tag -&gt; term int_tag.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Fixpoint get_int (e : term int_tag) : int :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  match e in term t0 return t0 = int_tag -&gt; int with</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Int n =&gt; fun eq0 =&gt; ltac:(subst; exact n)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Sum e1 e2 =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fun eq0 =&gt; ltac:(subst; exact (Z.add (get_int e1) (get_int e2)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | _ =&gt; ltac:(discriminate)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end eq_refl.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Notice that without the use of tags we would have the following code instead:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Inductive term : Set :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Int : int -&gt; term</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| String : string -&gt; term</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Sum : expr -&gt; expr -&gt; term</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Pair : expr -&gt; expr -&gt; term.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Fixpoint get_int (e : term) : int :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  match e with</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Int n =&gt; n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Sum e1 e2 =&gt; Z.add (get_int e1) (get_int e2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | _ =&gt; unreachable_gadt_branch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>As we can see this naive translation uses the <code>unreachable_gadt_branch</code> axiom.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="coq_type_annotation">coq_type_annotation<a class="hash-link" href="#coq_type_annotation" title="Direct link to heading">​</a></h2><p>Sometimes we need to add a type annotation on an expression, either as a documentation or to help the Coq code to compile. We translate this OCaml example:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> n1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> m </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> n1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> m</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">@</span><span class="token plain">coq_type_annotation</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  n1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>to:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Definition n1 : int :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let m := 12 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let n1 := (m : int) in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  n1.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>where we add an annotation <code>: int</code> on the expression <code>m</code>. The type we use for the annotation is the type inferred by the OCaml compiler.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/coq-of-ocaml/gadts"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">GADTs</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/coq-of-ocaml/configuration"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Configuration</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#coq_axiom_with_reason" class="table-of-contents__link toc-highlight">coq_axiom_with_reason</a></li><li><a href="#coq_cast" class="table-of-contents__link toc-highlight">coq_cast</a></li><li><a href="#coq_force_gadt" class="table-of-contents__link toc-highlight">coq_force_gadt</a></li><li><a href="#coq_grab_existentials" class="table-of-contents__link toc-highlight">coq_grab_existentials</a></li><li><a href="#coq_implicit" class="table-of-contents__link toc-highlight">coq_implicit</a></li><li><a href="#coq_match_gadt" class="table-of-contents__link toc-highlight">coq_match_gadt</a></li><li><a href="#coq_match_gadt_with_result" class="table-of-contents__link toc-highlight">coq_match_gadt_with_result</a></li><li><a href="#coq_match_with_default" class="table-of-contents__link toc-highlight">coq_match_with_default</a></li><li><a href="#coq_mutual_as_notation" class="table-of-contents__link toc-highlight">coq_mutual_as_notation</a></li><li><a href="#coq_phantom" class="table-of-contents__link toc-highlight">coq_phantom</a></li><li><a href="#coq_plain_module" class="table-of-contents__link toc-highlight">coq_plain_module</a></li><li><a href="#coq_precise_signature" class="table-of-contents__link toc-highlight">coq_precise_signature</a></li><li><a href="#coq_struct" class="table-of-contents__link toc-highlight">coq_struct</a></li><li><a href="#coq_tag_gadt" class="table-of-contents__link toc-highlight">coq_tag_gadt</a></li><li><a href="#coq_tagged_match" class="table-of-contents__link toc-highlight">coq_tagged_match</a></li><li><a href="#coq_type_annotation" class="table-of-contents__link toc-highlight">coq_type_annotation</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Contet</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/company/intro">Company</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/company/claims">Claims</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/company/press">Press</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/company/about">About</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/LandFoobar" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.nomadic-labs.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Nomadic Labs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/foobar-land" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://foobar-land.github.io/coq-of-ocaml/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>coq-of-ocaml<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://nomadic-labs.gitlab.io/coq-tezos-of-ocaml/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Coq Tezos of OCaml<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Formal Land 🐦, Paris<br>❤️</div></div></div></footer></div>
<script src="/assets/js/runtime~main.a9329436.js"></script>
<script src="/assets/js/main.d5dfeb25.js"></script>
</body>
</html>