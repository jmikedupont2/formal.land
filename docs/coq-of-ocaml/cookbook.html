<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Formal Land RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Formal Land Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MQLHF4EV4J"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-MQLHF4EV4J",{anonymize_ip:!0})</script><title data-react-helmet="true">Cookbook | Formal Land</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://formal.land/img/land-512.png"><meta data-react-helmet="true" name="twitter:image" content="https://formal.land/img/land-512.png"><meta data-react-helmet="true" property="og:url" content="https://formal.land/docs/coq-of-ocaml/cookbook"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Cookbook | Formal Land"><meta data-react-helmet="true" name="description" content="Here we list typical situations where we need to change the OCaml source code so that the translated code compiles in Coq."><meta data-react-helmet="true" property="og:description" content="Here we list typical situations where we need to change the OCaml source code so that the translated code compiles in Coq."><link data-react-helmet="true" rel="icon" href="/img/land-512.png"><link data-react-helmet="true" rel="canonical" href="https://formal.land/docs/coq-of-ocaml/cookbook"><link data-react-helmet="true" rel="alternate" href="https://formal.land/docs/coq-of-ocaml/cookbook" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://formal.land/docs/coq-of-ocaml/cookbook" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.ee19e85b.css">
<link rel="preload" href="/assets/js/runtime~main.ac2009e1.js" as="script">
<link rel="preload" href="/assets/js/main.37bfe1c0.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" style="background-color:#fafbfc;color:#091E42" role="banner"><div class="announcementBarContent_3EUC">We are hiring! 📣 See our <a href="/docs/company/careers">job offers 🌷</a>.</div></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/land-512.png" alt="Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/land-512.png" alt="Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Formal Land</b></a><a class="navbar__item navbar__link" href="/docs/company/about">Company</a><a class="navbar__item navbar__link" href="/docs/verification/ocaml">Formal verification</a><a class="navbar__item navbar__link" href="/docs/services/solidity-development">Services</a><a class="navbar__item navbar__link" href="/docs/coq-of-ocaml/introduction">coq-of-ocaml</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/formal-land" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">🌜</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">🌞</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/docs/company/about">Company</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/docs/verification/ocaml">Formal verification</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/docs/services/ocaml-development">Services</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_2fq0" href="/docs/coq-of-ocaml/introduction">🐫 coq-of-ocaml</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coq-of-ocaml/introduction">What is coq-of-ocaml</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coq-of-ocaml/install">Install</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coq-of-ocaml/run">Run</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/coq-of-ocaml/cookbook">Cookbook</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" tabindex="0" href="/docs/coq-of-ocaml/ocaml-core">Language</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" tabindex="0" href="/docs/coq-of-ocaml/attributes">Options</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" tabindex="0" href="/docs/coq-of-ocaml/examples">More</a></div></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Cookbook</h1></header><p>Here we list typical situations where we need to change the OCaml source code so that the translated code compiles in Coq.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="abstractions-in-mli-files">Abstractions in <code>.mli</code> files<a class="hash-link" href="#abstractions-in-mli-files" title="Direct link to heading">​</a></h2><p>When generating the Coq code, we do not use the notion of <code>.mli</code> because there are no such interface files in Coq. So the typical setup is to generate a <code>.v</code> file for each <code>.ml</code> file, and only translate the <code>.mli</code> files of the external dependencies to axiom files.</p><p>An issue in this process is that there can be differences between what a <code>.v</code> file sees and what a <code>.ml</code> file was seeing. For example, let us say that we have the following files:</p><ul><li><code>a.ml</code>:</li></ul><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> S </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sig</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> pub </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> int </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">S_internal</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sig</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> pub </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> int </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> priv </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> int </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> M </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">S_internal</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> pub x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> x </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> priv x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> x </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li><code>a.mli</code>:</li></ul><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> S </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sig</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> pub </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> int </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> M </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> S</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li><code>b.ml</code>:</li></ul><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> f x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> A</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">M</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pub x</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Then from the point of view of <code>b.ml</code>, <code>A.M</code> is of signature <code>A.S</code> and there are no ways to know about <code>A.S_internal</code>. However, in Coq, since we did not translate the <code>.mli</code> file, <code>A.M</code> appears as having the signature <code>S_internal</code>. Since we translate signatures to records, which do not have the notion of inclusion, <code>A.M</code> does not have the same type in Coq and OCaml. This can introduce bugs when we translate a signature annotation <code>S</code> to Coq, as Coq expects a signature <code>S_internal</code>.</p><p>A solution for this issue is to open the abstraction in <code>a.mli</code> by using the signature <code>S_internal</code> instead of <code>S</code>. A general solution on the side of <code>coq-of-ocaml</code> would be to translate the <code>.mli</code> to <code>.v</code> files doing the plumbing from <code>S</code> to <code>S_internal</code>. We have not done that yet, because of lack of time and because we believe that having <code>.v</code> files to do plumbing can also have a cost for the proofs.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="fixpoint-struct-annotations">Fixpoint struct annotations<a class="hash-link" href="#fixpoint-struct-annotations" title="Direct link to heading">​</a></h2><p>In Coq, fixpoints (recursive functions) must be structurally decreasing on one of the arguments to make sure that the function always terminates. When structural termination is not obvious, we can disable this check with the configuration option <a href="/docs/coq-of-ocaml/configuration#without_guard_checking">without_guard_checking</a>. However, Coq still requires to consider one of the parameters as the decreasing one, even if this is not structurally the case. A decreasing parameter is still required to know how far to unfold recursive definitions while doing proofs.</p><p>The way to specify the decreasing parameter is to use the attribute <a href="/docs/coq-of-ocaml/attributes#coq_struct">coq_struct</a>. For example we annotate the operator <code>--&gt;</code> as follows:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">@</span><span class="token plain">coq_struct </span><span class="token string" style="color:#e3116c">&quot;i&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rec</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">--&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> i j </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">(* [i; i+1; ...; j] *)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Compare</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module variable" style="color:#36acaa">Int</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> j</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> i </span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">succ i </span><span class="token operator" style="color:#393A34">--&gt;</span><span class="token plain"> j</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Here <code>i</code> is decreasing when we consider the natural order on <code>-i</code>. This generates the following Coq code:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Fixpoint op_minusminusgt (i : int) (j : int) {struct i} : list int :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if i &gt;i j then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nil</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cons i (op_minusminusgt (Pervasives.succ i) j).</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The annotation <code>{struct i}</code> specifies in Coq that the decreasing parameter is <code>i</code>.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="ignored-functions">Ignored functions<a class="hash-link" href="#ignored-functions" title="Direct link to heading">​</a></h2><p>Sometimes definitions are too complex to translate to Coq, but we still want to go on with the rest of the files. A solution is to add the <a href="/docs/coq-of-ocaml/attributes#coq_axiom_with_reason">coq_axiom_with_reason</a> to ignore a definition and replace it with an axiom of the same type.</p><p>For example, the following definition would not work in Coq as is it is, due to the use of GADTs:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> fold_all f set acc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token module variable" style="color:#36acaa">List</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fold_left</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> acc </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Ex_Kind</span><span class="token plain"> kind</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> fold kind </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">f</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">f kind</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> set acc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      acc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      all</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>We then add the attribute <code>@coq_axiom_with_reason</code>:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> fold_all f set acc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token module variable" style="color:#36acaa">List</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fold_left</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> acc </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Ex_Kind</span><span class="token plain"> kind</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> fold kind </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">f</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">f kind</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> set acc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      acc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">@@</span><span class="token plain">coq_axiom_with_reason </span><span class="token string" style="color:#e3116c">&quot;gadt&quot;</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This generates the following Coq code:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Axiom fold_all : forall {A : Set}, fold_f A -&gt; t -&gt; A -&gt; A.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>which compiles and has the right type, even if we lost the translation of the body of <code>fold_all</code>. With this attribute we must add a reason, so that we document we chose to introduce an axiom. Among frequent reasons are the use of GADTs and complex recursive functions.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="mutual-definitions-as-notations">Mutual definitions as notations<a class="hash-link" href="#mutual-definitions-as-notations" title="Direct link to heading">​</a></h2><p>Sometimes mutual definitions for a recursive function are used more as notations rather than to express a true mutual recursion. See the attribute <a href="/docs/coq-of-ocaml/attributes#coq_mutual_as_notation">coq_mutual_as_notation</a> for more details about how to handle this kind of definition. Here is an example where this attribute is needed:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rec</span><span class="token plain"> double_list l </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">match</span><span class="token plain"> l </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> l</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> n </span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> l </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> double n </span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> double_list l</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">and</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">@</span><span class="token plain">coq_mutual_as_notation</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> double n </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> n</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>which translates in Coq to:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Reserved Notation &quot;&#x27;double&quot;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Fixpoint double_list (l : list int) : list int :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let double := &#x27;double in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  match l with</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | [] =&gt; l</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | cons n l =&gt; cons (double n) (double_list l)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">where &quot;&#x27;double&quot; := (fun (n : int) =&gt; Z.mul 2 n).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Definition double := &#x27;double.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="named-signatures">Named signatures<a class="hash-link" href="#named-signatures" title="Direct link to heading">​</a></h2><p>We translate modules used in functors as records in Coq. We require a name for the signatures to have a name for the corresponding records. Sometimes, in OCaml, when a signature is used just once it is inlined and not named. Here is an example of code with an anonymous signature for the return signature of the functor <code>Make_indexed_carbonated_data_storage</code>:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Make_indexed_carbonated_data_storage</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">C </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Raw_context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">T</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">I </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">INDEX</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">V </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">VALUE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sig</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">include</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token module variable" style="color:#36acaa">Non_iterable_indexed_carbonated_data_storage</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> C</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> I</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">value</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> V</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> list_values </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">?</span><span class="token plain">offset</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">int </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">?</span><span class="token plain">length</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">int </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    C</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token module variable" style="color:#36acaa">Raw_context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> V</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t list</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> tzresult </span><span class="token module variable" style="color:#36acaa">Lwt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">include</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Make_indexed_carbonated_data_storage_INTERNAL</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">C</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">I</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">V</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This generates the following error message in <code>coq-of-ocaml</code>:</p><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">--- storage_functors.ml:527:19 --------------------------------------------- not_supported (1/1) ---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  525 |     (C : Raw_context.T)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  526 |     (I : INDEX)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; 527 |     (V : VALUE) : sig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; 528 |   include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; 529 |     Non_iterable_indexed_carbonated_data_storage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; 530 |       with type t = C.t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; 531 |        and type key = I.t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; 532 |        and type value = V.t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; 533 | </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; 534 |   val list_values :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; 535 |     ?offset:int -&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; 536 |     ?length:int -&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; 537 |     C.t -&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; 538 |     (Raw_context.t * V.t list) tzresult Lwt.t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; 539 | end = struct</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  540 |   include Make_indexed_carbonated_data_storage_INTERNAL (C) (I) (V)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  541 | end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  542 | </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Anonymous definition of signatures is not handled</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>We replace it by the following OCaml code, which translates into Coq without errors:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Non_iterable_indexed_carbonated_data_storage_with_values</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sig</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">include</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Non_iterable_indexed_carbonated_data_storage</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> list_values </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">?</span><span class="token plain">offset</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">int </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">?</span><span class="token plain">length</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">int </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token module variable" style="color:#36acaa">Raw_context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">value</span><span class="token plain"> list</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> tzresult </span><span class="token module variable" style="color:#36acaa">Lwt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Make_indexed_carbonated_data_storage</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">C </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Raw_context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">T</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">I </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">INDEX</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">V </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">VALUE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token module variable" style="color:#36acaa">Non_iterable_indexed_carbonated_data_storage_with_values</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> C</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> I</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">value</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> V</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">include</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Make_indexed_carbonated_data_storage_INTERNAL</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">C</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">I</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">V</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>There we named the return signature of the functor <code>Non_iterable_indexed_carbonated_data_storage_with_values</code>.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="named-polymorphic-variant-types">Named polymorphic variant types<a class="hash-link" href="#named-polymorphic-variant-types" title="Direct link to heading">​</a></h2><p>In the following OCaml code, the type of the parameter <code>depth</code> is a polymorphic variant type:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> fold </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">?</span><span class="token plain">depth</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token variant variable" style="color:#36acaa">`Eq</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> int </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token variant variable" style="color:#36acaa">`Le</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> int </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token variant variable" style="color:#36acaa">`Lt</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> int </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token variant variable" style="color:#36acaa">`Ge</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> int </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token variant variable" style="color:#36acaa">`Gt</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> int</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  key </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  init</span><span class="token punctuation" style="color:#393A34">:</span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  f</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> tree </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Lwt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Lwt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>We do not handle this kind of type in <code>coq-of-ocaml</code>, because there are no clear equivalent features in Coq. In most of the code, we would replace this declaration with an algebraic datatype as follows:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> depth </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Eq</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Le</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Lt</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Ge</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Gt</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> fold </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">?</span><span class="token plain">depth</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">depth </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  key </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  init</span><span class="token punctuation" style="color:#393A34">:</span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  f</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> tree </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Lwt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Lwt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Sometimes it is not possible to do this kind of change, for backward compatibility of an API for example. In this case we name the polymorphic variant type:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> depth </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token variant variable" style="color:#36acaa">`Eq</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> int </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token variant variable" style="color:#36acaa">`Le</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> int </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token variant variable" style="color:#36acaa">`Lt</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> int </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token variant variable" style="color:#36acaa">`Ge</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> int </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token variant variable" style="color:#36acaa">`Gt</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> int</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> fold </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">?</span><span class="token plain">depth</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">depth </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  key </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  init</span><span class="token punctuation" style="color:#393A34">:</span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  f</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> tree </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Lwt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Lwt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>We translate the definition of <code>depth</code> as if it was an algebraic datatype:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Inductive depth : Set :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Ge : int -&gt; depth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Lt : int -&gt; depth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Eq : int -&gt; depth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Le : int -&gt; depth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Gt : int -&gt; depth.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Then, using the configuration parameters <a href="/docs/coq-of-ocaml/configuration#variant_constructors">variant_constructors</a> and <a href="/docs/coq-of-ocaml/configuration#variant_types">variant_types</a>, we instruct <code>coq-of-ocaml</code> to recognize that there is a type <code>depth</code> whenever it finds a constructor <code> `Eq</code>, ..., or <code> `Gt</code> in the OCaml code.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="nested-anonymous-signatures">Nested anonymous signatures<a class="hash-link" href="#nested-anonymous-signatures" title="Direct link to heading">​</a></h2><p>There is support for nested anonymous signatures in <code>coq-of-ocaml</code>, but this often does not work well for various reasons. The key reason is that we translate signatures to records, which can only be flat. An example of a nested anonymous signature is the following:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">TitleWithId</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sig</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> title </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Id</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sig</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">include</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Temp</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Temp_id</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">IdSet</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Set</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">S </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> elt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Id</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Here the signature of <code>Id</code> is anonymous and nested in the signature <code>TitleWithId</code>. By default, <code>coq-of-ocaml</code> will try to prefix all the fields of the sub-module <code>Id</code> by <code>Id_</code> and flatten these fields into the fields of <code>TitleWithId</code>:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Module TitleWithId.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Record signature {Id_t IdSet_t : Set} : Set := {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    title : string;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Id_t := Id_t;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Id_compare : Id_t -&gt; Id_t -&gt; int;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (* ... included fields from [ID] *)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Id_Temp : Temp_id (t := t); (* there is an error: should be [(t := Id_t)] *)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    IdSet : _Set.S (elt := Id.(IdWithTemp.t)) (t := IdSet_t);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End TitleWithId.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Definition TitleWithId := @TitleWithId.signature.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Arguments TitleWithId {_ _}.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This works well if <code>Id</code> is used as a namespace in <code>TitleWithId</code> to group the fields in different categories. However, this fails if we aim to directly reference the sub-module <code>Id</code> later on.</p><p>A better solution is often to name the anonymous sub-signatures, by doing:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">IdWithTemp</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sig</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">include</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Temp</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Temp_id</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">TitleWithId</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sig</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> title </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Id</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">IdWithTemp</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">IdSet</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Set</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">S </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> elt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Id</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The translation is then:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Module IdWithTemp.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Record signature {t : Set} : Set := {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    t := t;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compare : t -&gt; t -&gt; int;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (* ... included fields from [ID] *)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Temp : Temp_id (t := t);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End IdWithTemp.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Definition IdWithTemp := @IdWithTemp.signature.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Arguments IdWithTemp {_}.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Module TitleWithId.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Record signature {Id_t IdSet_t : Set} : Set := {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    title : string;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Id : IdWithTemp (t := Id_t);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    IdSet : _Set.S (elt := Id.(IdWithTemp.t)) (t := IdSet_t);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End TitleWithId.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Definition TitleWithId := @TitleWithId.signature.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Arguments TitleWithId {_ _}.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="non-mutually-recursive-types">Non-mutually recursive types<a class="hash-link" href="#non-mutually-recursive-types" title="Direct link to heading">​</a></h2><p>Sometimes, because this is convenient, we use the syntax <code>type ... and</code> for types which are not mutually dependent. For example, we could write in OCaml:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token plain"> matching_function </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> match_result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> match_result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">string </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> int option</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> list</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>to show the definition of <code>matching_function</code> first. This example would not work in Coq because mutually recursive definitions have to be with at least one algebraic type definition. Even for cases where the translation works, having too many mutually recursive type definitions may complexify the proofs.</p><p>For all these reasons, it is better to only use the <code>and</code> keyword for types that are truly mutually recursive. In this case, we rewrite our example as:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> match_result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">string </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> int option</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token plain"> matching_function </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> match_result</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="top-level-name-collisions">Top-level name collisions<a class="hash-link" href="#top-level-name-collisions" title="Direct link to heading">​</a></h2><p>In Coq, it is not possible to have two definitions of the same name at top-level. For example, if we translate the following OCaml code:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">RPC_path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">open_root </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;context&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;delegates&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">RPC_path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">path </span><span class="token operator" style="color:#393A34">/:</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Signature</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module variable" style="color:#36acaa">Public_key_hash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">rpc_arg</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>we get in Coq:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Definition path : RPC_path.path Updater.rpc_context Updater.rpc_context :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  RPC_path.op_div (RPC_path.op_div RPC_path.open_root &quot;context&quot;) &quot;delegates&quot;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Definition path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  : RPC_path.path Updater.rpc_context</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (Updater.rpc_context * Signature.public_key_hash) :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  RPC_path.op_divcolon path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Signature.Public_key_hash.(S.SIGNATURE_PUBLIC_KEY_HASH.rpc_arg).</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>which generates the error:</p><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Error: path already exists.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>A solution is to rename one of the two paths in OCaml:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> raw_path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">RPC_path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">open_root </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;context&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;delegates&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">RPC_path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">raw_path </span><span class="token operator" style="color:#393A34">/:</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Signature</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module variable" style="color:#36acaa">Public_key_hash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">rpc_arg</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This kind of situation can also happen when including modules. For example, there is a collision if an included module has names that already exist at the current level. We believe this is a good thing that Coq forbids redefining names at top-level. So using <code>coq-of-ocaml</code> can be a good thing to forbid this practice in OCaml. Note however that it is still possible to redefine names inside an expression in Coq.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/coq-of-ocaml/run"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Run</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/coq-of-ocaml/ocaml-core"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">OCaml core</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#abstractions-in-mli-files" class="table-of-contents__link toc-highlight">Abstractions in <code>.mli</code> files</a></li><li><a href="#fixpoint-struct-annotations" class="table-of-contents__link toc-highlight">Fixpoint struct annotations</a></li><li><a href="#ignored-functions" class="table-of-contents__link toc-highlight">Ignored functions</a></li><li><a href="#mutual-definitions-as-notations" class="table-of-contents__link toc-highlight">Mutual definitions as notations</a></li><li><a href="#named-signatures" class="table-of-contents__link toc-highlight">Named signatures</a></li><li><a href="#named-polymorphic-variant-types" class="table-of-contents__link toc-highlight">Named polymorphic variant types</a></li><li><a href="#nested-anonymous-signatures" class="table-of-contents__link toc-highlight">Nested anonymous signatures</a></li><li><a href="#non-mutually-recursive-types" class="table-of-contents__link toc-highlight">Non-mutually recursive types</a></li><li><a href="#top-level-name-collisions" class="table-of-contents__link toc-highlight">Top-level name collisions</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Content</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/company/about">Company</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/company/claims">Claims</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/company/press">Press</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/LandFoobar" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://fr.linkedin.com/company/formal-land" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Linkedin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.nomadic-labs.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Nomadic Labs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/formal-land" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/formal-land/coq-of-ocaml" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>coq-of-ocaml<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://formal-land.gitlab.io/coq-tezos-of-ocaml/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Coq Tezos of OCaml<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Formal Land 🐦, Paris<br><em>Formal verification for everyday-life programs 🏇.</em></div></div></div></footer></div>
<script src="/assets/js/runtime~main.ac2009e1.js"></script>
<script src="/assets/js/main.37bfe1c0.js"></script>
</body>
</html>