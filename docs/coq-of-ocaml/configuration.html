<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Formal Land RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Formal Land Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MQLHF4EV4J"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-MQLHF4EV4J",{anonymize_ip:!0})</script><title data-react-helmet="true">Configuration | Formal Land</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://formal.land/img/land-512.png"><meta data-react-helmet="true" name="twitter:image" content="https://formal.land/img/land-512.png"><meta data-react-helmet="true" property="og:url" content="https://formal.land/docs/coq-of-ocaml/configuration"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Configuration | Formal Land"><meta data-react-helmet="true" name="description" content="We present the configuration mechanism of coq-of-ocaml to define some global settings. We write the configuration in a file in the JSON format. To run coq-of-ocaml with a configuration file, use the -config option:"><meta data-react-helmet="true" property="og:description" content="We present the configuration mechanism of coq-of-ocaml to define some global settings. We write the configuration in a file in the JSON format. To run coq-of-ocaml with a configuration file, use the -config option:"><link data-react-helmet="true" rel="icon" href="/img/land-512.png"><link data-react-helmet="true" rel="canonical" href="https://formal.land/docs/coq-of-ocaml/configuration"><link data-react-helmet="true" rel="alternate" href="https://formal.land/docs/coq-of-ocaml/configuration" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://formal.land/docs/coq-of-ocaml/configuration" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.cc776f64.css">
<link rel="preload" href="/assets/js/runtime~main.09c92dd9.js" as="script">
<link rel="preload" href="/assets/js/main.7add5677.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" style="background-color:#fafbfc;color:#091E42" role="banner"><div class="announcementBarContent_3EUC">For formal verification services or advice, contact us at <a href="mailto:&#099;&#111;&#110;&#116;&#097;&#099;&#116;&#064;formal&#046;&#108;&#097;&#110;&#100;">&#099;&#111;&#110;&#116;&#097;&#099;&#116;&#064;formal&#046;&#108;&#097;&#110;&#100;</a>!</div></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/land-512.png" alt="Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/land-512.png" alt="Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Formal Land</b></a><a class="navbar__item navbar__link" href="/docs/company/about">Company</a><a class="navbar__item navbar__link" href="/docs/verification/ocaml">Formal verification</a><a class="navbar__item navbar__link" href="/docs/services/solidity-development">Services</a><a class="navbar__item navbar__link" href="/docs/coq-of-ocaml/introduction">coq-of-ocaml</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/formal-land" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://gitlab.com/formal-land" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitLab<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/docs/company/about">Company</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/docs/verification/ocaml">Formal verification</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/docs/services/ocaml-development">Services</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_2fq0" href="/docs/coq-of-ocaml/introduction">üê´ coq-of-ocaml</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coq-of-ocaml/introduction">What is coq-of-ocaml</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coq-of-ocaml/install">Install</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coq-of-ocaml/run">Run</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coq-of-ocaml/cookbook">Cookbook</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" tabindex="0" href="/docs/coq-of-ocaml/ocaml-core">Language</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_2fq0" tabindex="0" href="/docs/coq-of-ocaml/attributes">Options</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coq-of-ocaml/attributes">Attributes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/coq-of-ocaml/configuration">Configuration</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" tabindex="0" href="/docs/coq-of-ocaml/examples">More</a></div></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Configuration</h1></header><p>We present the configuration mechanism of <code>coq-of-ocaml</code> to define some global settings. We write the configuration in a file in the <a href="https://www.json.org/json-en.html" target="_blank" rel="noopener noreferrer">JSON format</a>. To run <code>coq-of-ocaml</code> with a configuration file, use the <code>-config</code> option:</p><div class="codeBlockContainer_K1bP language-sh theme-code-block"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">coq-of-ocaml -config configuration.json ...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The general structure of a configuration file is an object of entry keys and values:</p><div class="codeBlockContainer_K1bP language-sh theme-code-block"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;entry_1&quot;: value_1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;entry_n&quot;: value_n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>An example is:</p><div class="codeBlockContainer_K1bP language-json theme-code-block"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;error_message_blacklist&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;Unbound module Tezos_protocol_alpha_functor&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;monadic_operators&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;Error_monad.op_gtgteq&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;let=&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;Error_monad.op_gtgteqquestion&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;let=?&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;Error_monad.op_gtgtquestion&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;let?&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;require&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;Tezos_raw_protocol_alpha&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Tezos&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;variant_constructors&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;Dir&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Context.Dir&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;Key&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Context.Key&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;Hex&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;MBytes.Hex&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;without_positivity_checking&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;src/proto_alpha/lib_protocol/storage_description.ml&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The configuration entries are described as follows.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="alias_barrier_modules">alias_barrier_modules<a class="hash-link" href="#alias_barrier_modules" title="Direct link to heading">‚Äã</a></h2><h4 class="anchor anchorWithStickyNavbar_31ik" id="example">Example<a class="hash-link" href="#example" title="Direct link to heading">‚Äã</a></h4><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;alias_barrier_modules&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Tezos_protocol_environment_alpha__Environment&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="value">Value<a class="hash-link" href="#value" title="Direct link to heading">‚Äã</a></h4><p>A list of module names at which to stop when iterating through record aliases to find the initial record definition.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="explanation">Explanation<a class="hash-link" href="#explanation" title="Direct link to heading">‚Äã</a></h4><p>An example of OCaml code with a record alias is:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> A </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">a </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> b </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> bool</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> B </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> A</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">a </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> b </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> bool</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">B</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;hi&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> b </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>which generates:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Module A.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Module t.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Record record : Set := Build {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      a : string;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      b : bool }.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Definition with_a a (r : record) :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Build a r.(b).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Definition with_b b (r : record) :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Build r.(a) b.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  End t.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Definition t := t.record.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End A.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Module B.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Definition t : Set := A.t.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End B.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Definition x : B.t := {| A.t.a := &quot;hi&quot;; A.t.b := true |}.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Even if in OCaml we can talk about the field <code>B.a</code>, in Coq we transform it to <code>A.t.a</code> so that there is a single record definition. To do this transformation, we go through the record aliases up to the alias barriers, if any.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="constant_warning">constant_warning<a class="hash-link" href="#constant_warning" title="Direct link to heading">‚Äã</a></h2><h4 class="anchor anchorWithStickyNavbar_31ik" id="example-1">Example<a class="hash-link" href="#example-1" title="Direct link to heading">‚Äã</a></h4><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;constant_warning&quot;: false</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="value-1">Value<a class="hash-link" href="#value-1" title="Direct link to heading">‚Äã</a></h4><p>A boolean to select if there should be a warning in the generated code on some constants. A typical example are the integer constants which are all treated as <code>int</code>. The default of this option is <code>true</code>.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="explanation-1">Explanation<a class="hash-link" href="#explanation-1" title="Direct link to heading">‚Äã</a></h4><p>Without setting this option to <code>false</code>, the output of the following code:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> n </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> int64 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12</span><span class="token plain">L</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>is:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Definition n : int64 :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (* ‚ùå Constant of type int64 is converted to int *)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  12.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Setting the <code>constant_warning</code> option to <code>false</code> we get:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Definition n : int64 := 12.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="constructor_map">constructor_map<a class="hash-link" href="#constructor_map" title="Direct link to heading">‚Äã</a></h2><h4 class="anchor anchorWithStickyNavbar_31ik" id="example-2">Example<a class="hash-link" href="#example-2" title="Direct link to heading">‚Äã</a></h4><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;constructor_map&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;public_key_hash&quot;, &quot;Ed25519&quot;, &quot;Ed25519Hash&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;public_key_hash&quot;, &quot;P256&quot;, &quot;P256Hash&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;public_key_hash&quot;, &quot;Secp256k1&quot;, &quot;Secp256k1Hash&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="value-2">Value<a class="hash-link" href="#value-2" title="Direct link to heading">‚Äã</a></h4><p>A list of triples with a type name, a constructor name and a new constructor name to rename to. The type name must be the type name associated to the constructor, and is not prefixed by a module name. This type name is mostly there to help to disambiguate.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="explanation-2">Explanation<a class="hash-link" href="#explanation-2" title="Direct link to heading">‚Äã</a></h4><p>In OCaml we can have different types with the same constructor names, as long as the OCaml compiler can differentiate them based on type information. In Coq this is not the case. The definition of two constructors with the same name generates a name collision. For this reason, we can selectively rename some constructors in <code>coq-of-ocaml</code> in order to avoid name collisions in Coq.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="error_category_blacklist">error_category_blacklist<a class="hash-link" href="#error_category_blacklist" title="Direct link to heading">‚Äã</a></h2><h4 class="anchor anchorWithStickyNavbar_31ik" id="example-3">Example<a class="hash-link" href="#example-3" title="Direct link to heading">‚Äã</a></h4><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;error_category_blacklist&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;extensible_type&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;module&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;side_effect&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="value-3">Value<a class="hash-link" href="#value-3" title="Direct link to heading">‚Äã</a></h4><p>A list of error categories to black-list. The category of an error message is given in its header. For example:</p><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">--- foo.ml:1:1 ------------------------------------------- side_effect (1/1) ---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; 1 | let () =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; 2 |   print_endline &quot;hello world&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  3 | </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Top-level evaluations are ignored</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>is an error of category <code>side_effect</code>.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="explanation-3">Explanation<a class="hash-link" href="#explanation-3" title="Direct link to heading">‚Äã</a></h4><p>We may want to ignore some categories of errors in order to focus on other errors in a CI system for example.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="error_filename_blacklist">error_filename_blacklist<a class="hash-link" href="#error_filename_blacklist" title="Direct link to heading">‚Äã</a></h2><h4 class="anchor anchorWithStickyNavbar_31ik" id="example-4">Example<a class="hash-link" href="#example-4" title="Direct link to heading">‚Äã</a></h4><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;error_filename_blacklist&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;src/proto_alpha/lib_protocol/alpha_context.ml&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;src/proto_alpha/lib_protocol/alpha_context.mli&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="value-4">Value<a class="hash-link" href="#value-4" title="Direct link to heading">‚Äã</a></h4><p>A list of file names on which not to fail, even in case of errors. The return code of <code>coq-of-ocaml</code> is then 0 (success). We still display the error messages.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="explanation-4">Explanation<a class="hash-link" href="#explanation-4" title="Direct link to heading">‚Äã</a></h4><p>We may still want to see the error logs of some complicated files while not returning a fatal error.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="error_message_blacklist">error_message_blacklist<a class="hash-link" href="#error_message_blacklist" title="Direct link to heading">‚Äã</a></h2><h4 class="anchor anchorWithStickyNavbar_31ik" id="example-5">Example<a class="hash-link" href="#example-5" title="Direct link to heading">‚Äã</a></h4><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;error_message_blacklist&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Unbound module Tezos_protocol_alpha_functor&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="value-5">Value<a class="hash-link" href="#value-5" title="Direct link to heading">‚Äã</a></h4><p>A list of strings used to filtered out the error messages. An error message containing such a string is ignored.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="explanation-5">Explanation<a class="hash-link" href="#explanation-5" title="Direct link to heading">‚Äã</a></h4><p>We may want to ignore an error after manual inspection. This option allows to ignore an arbitrary error based on its error message.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="escape_value">escape_value<a class="hash-link" href="#escape_value" title="Direct link to heading">‚Äã</a></h2><h4 class="anchor anchorWithStickyNavbar_31ik" id="example-6">Example<a class="hash-link" href="#example-6" title="Direct link to heading">‚Äã</a></h4><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;escape_value&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;a&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;baking_rights_query&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;json&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="value-6">Value<a class="hash-link" href="#value-6" title="Direct link to heading">‚Äã</a></h4><p>A list of variable names to escape. We escape by replacing a name <code>foo</code> by <code>foo_value</code>. We do not escape type names or modules names.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="explanation-6">Explanation<a class="hash-link" href="#explanation-6" title="Direct link to heading">‚Äã</a></h4><p>In OCaml, the value and type namespaces are different. For example, we can have a string named <code>string</code> of type <code>string</code>. In Coq, we need to find an alternate name in order to avoid a name collision. If you have a name collision due to a value having the same name as a type, you can use this option to escape the value name (and only the value name).</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="first_class_module_path_blacklist">first_class_module_path_blacklist<a class="hash-link" href="#first_class_module_path_blacklist" title="Direct link to heading">‚Äã</a></h2><h4 class="anchor anchorWithStickyNavbar_31ik" id="example-7">Example<a class="hash-link" href="#example-7" title="Direct link to heading">‚Äã</a></h4><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;first_class_module_path_blacklist&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Tezos_raw_protocol_alpha&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="value-7">Value<a class="hash-link" href="#value-7" title="Direct link to heading">‚Äã</a></h4><p>A list of module names, typically corresponding to the module of a folder. All the modules which are direct children of such modules are considered as plain modules. They are encoded by Coq modules, even if there is a signature to make a corresponding record.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="explanation-7">Explanation<a class="hash-link" href="#explanation-7" title="Direct link to heading">‚Äã</a></h4><p>The module system of <code>coq-of-ocaml</code> encodes the modules having a signature name as dependent records. We use the signature name as the record type name. Sometimes, for modules corresponding to files, we want to avoid using records even if there is a named signature. This option prevents the record encoding for modules of the form <code>A.B</code> where <code>A</code> is in the black-list. For example, when a reference to a value <code>A.B.c</code> appears, we generate <code>A.B.c</code> rather than <code>A.B.(signature_name_of_B.c)</code>. Indeed, <code>A.B</code> is a Coq module rather than a record.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="first_class_module_signature_blacklist">first_class_module_signature_blacklist<a class="hash-link" href="#first_class_module_signature_blacklist" title="Direct link to heading">‚Äã</a></h2><h4 class="anchor anchorWithStickyNavbar_31ik" id="example-8">Example<a class="hash-link" href="#example-8" title="Direct link to heading">‚Äã</a></h4><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;first_class_module_signature_blacklist&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Sapling__Core_sig.T_encoding&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="value-8">Value<a class="hash-link" href="#value-8" title="Direct link to heading">‚Äã</a></h4><p>A list of OCaml signature names. We ignore these signatures when looking for a signature name to encode modules as records.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="explanation-8">Explanation<a class="hash-link" href="#explanation-8" title="Direct link to heading">‚Äã</a></h4><p>In <code>coq-of-ocaml</code>, we look for a named signature for each module we encounter. Once we find a named signature we encode the module as a dependent record. If no signatures can be found, we use a plain Coq module. Sometimes, we find an incorrect signature as we use heuristics to find a matching signature. This configuration option helps to ignore incorrect signatures.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="head_suffix">head_suffix<a class="hash-link" href="#head_suffix" title="Direct link to heading">‚Äã</a></h2><h4 class="anchor anchorWithStickyNavbar_31ik" id="example-9">Example<a class="hash-link" href="#example-9" title="Direct link to heading">‚Äã</a></h4><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;head_suffix&quot;: &quot;Import Environment.Notations.\n&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="value-9">Value<a class="hash-link" href="#value-9" title="Direct link to heading">‚Äã</a></h4><p>A string to add in the header of each file.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="explanation-9">Explanation<a class="hash-link" href="#explanation-9" title="Direct link to heading">‚Äã</a></h4><p>We can use this option to add some default imports, or turn on some notations or flags.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="merge_returns">merge_returns<a class="hash-link" href="#merge_returns" title="Direct link to heading">‚Äã</a></h2><h4 class="anchor anchorWithStickyNavbar_31ik" id="example-10">Example<a class="hash-link" href="#example-10" title="Direct link to heading">‚Äã</a></h4><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;merge_returns&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;return=&quot;, &quot;return?&quot;, &quot;return=?&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="value-10">Value<a class="hash-link" href="#value-10" title="Direct link to heading">‚Äã</a></h4><p>A list of triple of strings, with two return operator names which get translated into a third when applied together.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="explanation-10">Explanation<a class="hash-link" href="#explanation-10" title="Direct link to heading">‚Äã</a></h4><p>We use this configuration option to merge two return operators to a third equivalent one. Note that this only applies to monadic return operators, which are generated by the monadic configuration options. This option does not apply to standard function applications. As an example, we can generate the following code:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">let= ctxt :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (|Storage.Contract.Frozen_rewards|).(Storage_sigs.Indexed_data_storage.remove)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (ctxt, contract) cycle in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return=?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (ctxt,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {| frozen_balance.deposit := deposit; frozen_balance.fees := fees;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      frozen_balance.rewards := rewards |}).</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>instead of:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">let= ctxt :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (|Storage.Contract.Frozen_rewards|).(Storage_sigs.Indexed_data_storage.remove)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (ctxt, contract) cycle in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (return?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (ctxt,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {| frozen_balance.deposit := deposit; frozen_balance.fees := fees;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        frozen_balance.rewards := rewards |})).</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="merge_types">merge_types<a class="hash-link" href="#merge_types" title="Direct link to heading">‚Äã</a></h2><h4 class="anchor anchorWithStickyNavbar_31ik" id="example-11">Example<a class="hash-link" href="#example-11" title="Direct link to heading">‚Äã</a></h4><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;merge_types&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;M=&quot;, &quot;M?&quot;, &quot;M=?&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="value-11">Value<a class="hash-link" href="#value-11" title="Direct link to heading">‚Äã</a></h4><p>A list of triple of strings, with two type names which get translated into a third when applied together.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="explanation-11">Explanation<a class="hash-link" href="#explanation-11" title="Direct link to heading">‚Äã</a></h4><p>We use this configuration option for very specific use cases. It allows to merge two types together for when there is a more convenient notation. For example, we can generate the following code:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Definition burn_storage_fees</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (c : Raw_context.t) (storage_limit : Z.t) (payer : Contract_repr.t)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  : M=? Raw_context.t :=</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>instead of:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Definition burn_storage_fees</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (c : Raw_context.t) (storage_limit : Z.t) (payer : Contract_repr.t)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  : M= (M? Raw_context.t) :=</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="monadic_lets">monadic_lets<a class="hash-link" href="#monadic_lets" title="Direct link to heading">‚Äã</a></h2><h4 class="anchor anchorWithStickyNavbar_31ik" id="example-12">Example<a class="hash-link" href="#example-12" title="Direct link to heading">‚Äã</a></h4><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;monadic_lets&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;Error_monad.op_gtgteq&quot;, &quot;let=&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;Error_monad.op_gtgteqquestion&quot;, &quot;let=?&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;Error_monad.op_gtgtquestion&quot;, &quot;let?&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="value-12">Value<a class="hash-link" href="#value-12" title="Direct link to heading">‚Äã</a></h4><p>A list of couples of a monadic bind name and a monadic notation to use by <code>coq-of-ocaml</code>. You still have to define the notations somewhere, such as:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Notation &quot;&#x27;let?&#x27; x &#x27;:=&#x27; X &#x27;in&#x27; Y&quot; :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (Error_monad.op_gtgtquestion X (fun x =&gt; Y))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (at level 200, x ident, X at level 100, Y at level 200).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Notation &quot;&#x27;let?&#x27; &#x27; x &#x27;:=&#x27; X &#x27;in&#x27; Y&quot; :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (Error_monad.op_gtgtquestion X (fun x =&gt; Y))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (at level 200, x pattern, X at level 100, Y at level 200).</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The binder <code>x</code> can be a variable name or a pattern prefixed by <code>&#x27;</code>.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="explanation-12">Explanation<a class="hash-link" href="#explanation-12" title="Direct link to heading">‚Äã</a></h4><p>This helps to improve readability of code with effects written in a monadic style. For example:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">(* let (&gt;&gt;=) x f = ... *)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> operate x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  operation1 x </span><span class="token operator" style="color:#393A34">&gt;&gt;=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> z</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  operation2 y z</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>will generate, thanks to the notation mechanism:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Definition operate (x : string) : int :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let! &#x27;(y, z) := operation1 x in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  operation2 y z.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Note that you can also use the monadic notation in OCaml with the <a href="https://caml.inria.fr/pub/docs/manual-ocaml/bindingops.html" target="_blank" rel="noopener noreferrer">binding operators</a>.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="monadic_let_returns">monadic_let_returns<a class="hash-link" href="#monadic_let_returns" title="Direct link to heading">‚Äã</a></h2><h4 class="anchor anchorWithStickyNavbar_31ik" id="example-13">Example<a class="hash-link" href="#example-13" title="Direct link to heading">‚Äã</a></h4><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;monadic_let_returns&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;Error_monad.op_gtpipeeq&quot;, &quot;let=&quot;, &quot;return=&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;Error_monad.op_gtpipeeqquestion&quot;, &quot;let=?&quot;, &quot;return=?&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;Error_monad.op_gtpipequestion&quot;, &quot;let?&quot;, &quot;return?&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="value-13">Value<a class="hash-link" href="#value-13" title="Direct link to heading">‚Äã</a></h4><p>A list of triples of a function name, a monadic notation for a binder and a return function.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="explanation-13">Explanation<a class="hash-link" href="#explanation-13" title="Direct link to heading">‚Äã</a></h4><p>This allows to rewrite a monadic map operator as a combination of a monadic <code>let</code> and <code>return</code>. For example, we can translate:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">(* map : &#x27;a m -&gt; (&#x27;a -&gt; &#x27;b) -&gt; &#x27;b m *)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">(* f : &#x27;a m -&gt; &#x27;a m *)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> example x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  map </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">f x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> x </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> x </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>to:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Definition example (x : m int) : m int :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let! x := f x in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return! (Z.add x 1).</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="monadic_returns">monadic_returns<a class="hash-link" href="#monadic_returns" title="Direct link to heading">‚Äã</a></h2><h4 class="anchor anchorWithStickyNavbar_31ik" id="example-14">Example<a class="hash-link" href="#example-14" title="Direct link to heading">‚Äã</a></h4><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;monadic_returns&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;Lwt._return&quot;, &quot;return=&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;Error_monad._return&quot;, &quot;return=?&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;Error_monad.ok&quot;, &quot;return?&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="value-14">Value<a class="hash-link" href="#value-14" title="Direct link to heading">‚Äã</a></h4><p>A list of couples of a function name and a return function.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="explanation-14">Explanation<a class="hash-link" href="#explanation-14" title="Direct link to heading">‚Äã</a></h4><p>This allows to rewrite a return function as a return operator. For example, we can rewrite:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token plain"> m </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> return </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token type-variable function" style="color:#d73a49">&#x27;a</span><span class="token plain"> m </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> incr x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>to:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Definition m (a : Set) : Set := a * int.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Definition _return {a : Set} (x : a) : m a := (x, 0).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Definition incr (x : int) : m int := return! (Z.add x 1).</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>To define we return notation, we use:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Notation &quot;return! X&quot; := (_return X) (at level 20).</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>We add this notation by hand, as opposed to generate it in with <code>coq-of-ocaml</code>. Note that we use a notation for the return operator applied to some argument <code>X</code>. This is to have a correct syntax highlighting in the generated documentation with <code>coqdoc</code>. The following notation:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Notation &quot;return!&quot; := _return.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>would not generate the correct coloration with our current Coq version (8.12).</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="monadic_return_lets">monadic_return_lets<a class="hash-link" href="#monadic_return_lets" title="Direct link to heading">‚Äã</a></h2><h4 class="anchor anchorWithStickyNavbar_31ik" id="example-15">Example<a class="hash-link" href="#example-15" title="Direct link to heading">‚Äã</a></h4><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;monadic_return_lets&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;Error_monad.op_gtgtquestioneq&quot;, &quot;return=&quot;, &quot;let=?&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="value-15">Value<a class="hash-link" href="#value-15" title="Direct link to heading">‚Äã</a></h4><p>A list of triples of a function name, a return function and a monadic notation for a binder.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="explanation-15">Explanation<a class="hash-link" href="#explanation-15" title="Direct link to heading">‚Äã</a></h4><p>This allows to rewrite a monadic code with a special operator of the form:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">operator e1 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> x </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> e2</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>to:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">let! x := return? e1 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">e2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="operator_infix">operator_infix<a class="hash-link" href="#operator_infix" title="Direct link to heading">‚Äã</a></h2><h4 class="anchor anchorWithStickyNavbar_31ik" id="example-16">Example<a class="hash-link" href="#example-16" title="Direct link to heading">‚Äã</a></h4><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;operator_infix&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;Int32.add&quot;, &quot;+i32&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;Int32.sub&quot;, &quot;-i32&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;Int32.mul&quot;, &quot;*i32&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;Int32.div&quot;, &quot;/i32&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="value-16">Value<a class="hash-link" href="#value-16" title="Direct link to heading">‚Äã</a></h4><p>A list of couples of an operator name and its notation.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="explanation-16">Explanation<a class="hash-link" href="#explanation-16" title="Direct link to heading">‚Äã</a></h4><p>In order to generate readable code, for example for arithmetic expressions, we may want to use infix operators. For example, in our code we were able to go from:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">let all_votes := Int32.add casted_votes ballots.(Vote_storage.ballots.pass) in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let supermajority := Int32.div (Int32.mul 8 casted_votes) 10 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let participation :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Int64.to_int32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (Int64.div (Int64.mul (Int64.of_int32 all_votes) 10000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      (Int64.of_int32 maximum_vote)) in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let approval :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Pervasives.op_andand</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ((|Compare.Int32|).(Compare.S.op_gteq) participation expected_quorum)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ((|Compare.Int32|).(Compare.S.op_gteq) ballots.(Vote_storage.ballots.yay)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>to:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">let all_votes := casted_votes +i32 ballots.(Vote_storage.ballots.pass) in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let supermajority := (8 *i32 casted_votes) /i32 10 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let participation :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Int64.to_int32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (((Int64.of_int32 all_votes) *i64 10000) /i64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (Int64.of_int32 maximum_vote)) in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let approval :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (participation &gt;=i32 expected_quorum) &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (ballots.(Vote_storage.ballots.yay) &gt;=i32 supermajority) in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>using infix operators. We believe the second form to be much more readable.</p><p>Note that you need to define the notations by writing some Coq code. For example, for the <code>int32</code> notations we used:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Infix &quot;+i32&quot; := Int32.add (at level 50, left associativity).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Infix &quot;-i32&quot; := Int32.sub (at level 50, left associativity).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Infix &quot;*i32&quot; := Int32.mul (at level 40, left associativity).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Infix &quot;/i32&quot; := Int32.div (at level 40, left associativity).</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>There should be no bugs due to the precedence of the operators, as we always parenthesis in case of doubt. However, having the right precedence may be nice when doing the proofs and pretty-printing terms. A good way to know about the precedences is to look at the reserved operator of the <a href="https://coq.inria.fr/library/Coq.Init.Notations.html" target="_blank" rel="noopener noreferrer">standard library of Coq</a>.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="renaming_rules">renaming_rules<a class="hash-link" href="#renaming_rules" title="Direct link to heading">‚Äã</a></h2><h4 class="anchor anchorWithStickyNavbar_31ik" id="example-17">Example<a class="hash-link" href="#example-17" title="Direct link to heading">‚Äã</a></h4><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;renaming_rules&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;Stdlib.result&quot;, &quot;sum&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;Stdlib.List.map&quot;, &quot;List.map&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;Stdlib.List.rev&quot;, &quot;List.rev&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="value-17">Value<a class="hash-link" href="#value-17" title="Direct link to heading">‚Äã</a></h4><p>A list of couple of values, with a name and a name to rename to while doing the translation in Coq.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="explanation-17">Explanation<a class="hash-link" href="#explanation-17" title="Direct link to heading">‚Äã</a></h4><p>We may want to systematically rename some of the OCaml values to their counterpart in Coq. This rule applies to anything which has a name (value, type, module, constructor, ...). <code>coq-of-ocaml</code> already knows some renaming rules for the OCaml&#x27;s standard library, but it is possible to add more with this option.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="renaming_type_constructor">renaming_type_constructor<a class="hash-link" href="#renaming_type_constructor" title="Direct link to heading">‚Äã</a></h2><h4 class="anchor anchorWithStickyNavbar_31ik" id="example-18">Example<a class="hash-link" href="#example-18" title="Direct link to heading">‚Äã</a></h4><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;renaming_type_constructor&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;(|Compare.Char|).(Compare.S.t)&quot;, &quot;ascii&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;(|Compare.Int|).(Compare.S.t)&quot;, &quot;int&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;(|Compare.Int32|).(Compare.S.t)&quot;, &quot;int32&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;(|Compare.Int64|).(Compare.S.t)&quot;, &quot;int64&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;(|Compare.String|).(Compare.S.t)&quot;, &quot;string&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;(|Compare.Z|).(Compare.S.t)&quot;, &quot;Z.t&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">],</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="value-18">Value<a class="hash-link" href="#value-18" title="Direct link to heading">‚Äã</a></h4><p>A list of couples of a type constructor&#x27;s name and a new name to rename to.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="explanation-18">Explanation<a class="hash-link" href="#explanation-18" title="Direct link to heading">‚Äã</a></h4><p>In order to shorten the size of the generated Coq, we may want to rename some of the types. This is for example the case of types inside modules, like in the example above.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="require">require<a class="hash-link" href="#require" title="Direct link to heading">‚Äã</a></h2><h4 class="anchor anchorWithStickyNavbar_31ik" id="example-19">Example<a class="hash-link" href="#example-19" title="Direct link to heading">‚Äã</a></h4><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;require&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;Tezos_raw_protocol_alpha&quot;, &quot;Tezos&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="value-19">Value<a class="hash-link" href="#value-19" title="Direct link to heading">‚Äã</a></h4><p>A list of couples of a module name and a module to require from in Coq.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="explanation-19">Explanation<a class="hash-link" href="#explanation-19" title="Direct link to heading">‚Äã</a></h4><p>When we import a project with many files in Coq, we need to add the relevant <code>Require</code> directives for external references. For a require rule <code>[&quot;A&quot;, &quot;B&quot;]</code>, when we see in OCaml a reference to the module <code>A.M</code>, we generate in Coq the reference <code>M</code>. We also add a <code>Require B.M.</code> at the top of the file.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="require_import">require_import<a class="hash-link" href="#require_import" title="Direct link to heading">‚Äã</a></h2><h4 class="anchor anchorWithStickyNavbar_31ik" id="example-20">Example<a class="hash-link" href="#example-20" title="Direct link to heading">‚Äã</a></h4><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;require_import&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;Tezos_protocol_environment_alpha&quot;, &quot;Tezos&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="value-20">Value<a class="hash-link" href="#value-20" title="Direct link to heading">‚Äã</a></h4><p>A list of couples of a module name and a module to require import from in Coq.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="explanation-20">Explanation<a class="hash-link" href="#explanation-20" title="Direct link to heading">‚Äã</a></h4><p>Similar to the <code>require</code> command, with an additional <code>Import</code> in order to shorten the paths for commonly used modules.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="require_long_ident">require_long_ident<a class="hash-link" href="#require_long_ident" title="Direct link to heading">‚Äã</a></h2><h4 class="anchor anchorWithStickyNavbar_31ik" id="example-21">Example<a class="hash-link" href="#example-21" title="Direct link to heading">‚Äã</a></h4><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;require_long_ident&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;Storage_description&quot;, &quot;Tezos&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="value-21">Value<a class="hash-link" href="#value-21" title="Direct link to heading">‚Äã</a></h4><p>A list of module names and module namespaces to require from.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="explanation-21">Explanation<a class="hash-link" href="#explanation-21" title="Direct link to heading">‚Äã</a></h4><p>In some cases, it is not possible to get the right <code>Require</code> directive for an external reference. In particular when there is a long identifier rather than a path in the OCaml AST. With a rule <code>[&quot;A&quot;, &quot;B&quot;]</code>, a reference to the module <code>A</code> also generates the same reference <code>A</code> but adds a <code>Require B.A.</code> at the top of the output.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="require_mli">require_mli<a class="hash-link" href="#require_mli" title="Direct link to heading">‚Äã</a></h2><h4 class="anchor anchorWithStickyNavbar_31ik" id="example-22">Example<a class="hash-link" href="#example-22" title="Direct link to heading">‚Äã</a></h4><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;require_mli&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Storage&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Storage_functors&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="value-22">Value<a class="hash-link" href="#value-22" title="Direct link to heading">‚Äã</a></h4><p>A list of files to require as <code>.mli</code> rather than as <code>.ml</code>. The files are described by their corresponding module name.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="explanation-22">Explanation<a class="hash-link" href="#explanation-22" title="Direct link to heading">‚Äã</a></h4><p>In OCaml, there are two kinds of files, namely <code>.ml</code> and <code>.mli</code> files. We import both with <code>coq-of-ocaml</code>, but only the <code>.ml</code> file is complete and sufficient. The <code>.mli</code> import corresponds to axioms without the definitions. However, sometimes the import of the <code>.ml</code> version fails but the <code>.mli</code> works. Then, we may want to use the imported <code>.mli</code> as a dependency in the <code>Require</code> directive rather than the imported <code>.ml</code> version.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="variant_constructors">variant_constructors<a class="hash-link" href="#variant_constructors" title="Direct link to heading">‚Äã</a></h2><h4 class="anchor anchorWithStickyNavbar_31ik" id="example-23">Example<a class="hash-link" href="#example-23" title="Direct link to heading">‚Äã</a></h4><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;variant_constructors&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;Dir&quot;, &quot;Context.Dir&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;Key&quot;, &quot;Context.Key&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;Uint16&quot;, &quot;Data_encoding.Uint16&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;Uint8&quot;, &quot;Data_encoding.Uint8&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;Hex&quot;, &quot;MBytes.Hex&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="value-23">Value<a class="hash-link" href="#value-23" title="Direct link to heading">‚Äã</a></h4><p>A list of polymorphic variant constructor names in OCaml and constructor names in Coq.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="explanation-23">Explanation<a class="hash-link" href="#explanation-23" title="Direct link to heading">‚Äã</a></h4><p>Coq supports algebraic types through the <code>Inductive</code> keyword, but there are no direct equivalents for <a href="https://caml.inria.fr/pub/docs/manual-ocaml/lablexamples.html#s:polymorphic-variants" target="_blank" rel="noopener noreferrer">polymorphic variants</a>. We can replace many occurrences of polymorphic variants by standard algebraic types, updating the input code to help <code>coq-of-ocaml</code>. Sometimes, a direct modification of the source is not possible. We can then explain to <code>coq-of-ocaml</code> how to deal with polymorphic variants as if they were inductive types.</p><p>When there is a type definition with a polymorphic variant, <code>coq-of-ocaml</code> transforms it to the closest inductive:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">module</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Context</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token variant variable" style="color:#36acaa">`Dir</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token variant variable" style="color:#36acaa">`Key</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>generates:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Module Context.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Inductive t : Set :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Dir : t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Key : t.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End Context.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>When a constructor appears, this option helps to tell Coq from which module it is. For example:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> x </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token variant variable" style="color:#36acaa">`Dir</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>would be transformed to:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Definition x : Context.t := Dir.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>which is incorrect. By giving the relation <code>[&quot;Dir&quot;, &quot;Context.Dir&quot;]</code>, we can tell <code>coq-of-ocaml</code> to generate the correct constructor with the correct module prefix:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Definition x : Context.t := Context.Dir.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="variant_types">variant_types<a class="hash-link" href="#variant_types" title="Direct link to heading">‚Äã</a></h2><h4 class="anchor anchorWithStickyNavbar_31ik" id="example-24">Example<a class="hash-link" href="#example-24" title="Direct link to heading">‚Äã</a></h4><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;variant_types&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;Dir&quot;, &quot;Context.key_or_dir&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&quot;Key&quot;, &quot;Context.key_or_dir&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="value-24">Value<a class="hash-link" href="#value-24" title="Direct link to heading">‚Äã</a></h4><p>A list of couples of a polymorphic variant constructor and a type name to use when the constructor appears.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="explanation-24">Explanation<a class="hash-link" href="#explanation-24" title="Direct link to heading">‚Äã</a></h4><p>When we name a polymorphic variant with a type synonym:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token variant variable" style="color:#36acaa">`Dir</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token variant variable" style="color:#36acaa">`Key</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>an expression could still have a type without mentioning <code>t</code>:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> x </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token variant variable" style="color:#36acaa">`Dir</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token variant variable" style="color:#36acaa">`Dir</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Since the polymorphic variants do not have a direct equivalent in OCaml, we could instead use a standard algebraic type:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Dir</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> x </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Dir</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>which translates to:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Inductive t : Set :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Dir : t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Key : t.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Definition x : t := Dir.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>When removing polymorphic variants is not possible, <code>coq-of-ocaml</code> transforms the type definition to the closest inductive type:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Inductive t : Set :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Dir : t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Key : t.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>and with the setting <code>[&quot;Dir&quot;, &quot;t&quot;]</code> it also correctly transforms the type of <code>x</code>:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Definition x : t := Dir.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="without_guard_checking">without_guard_checking<a class="hash-link" href="#without_guard_checking" title="Direct link to heading">‚Äã</a></h2><h4 class="anchor anchorWithStickyNavbar_31ik" id="example-25">Example<a class="hash-link" href="#example-25" title="Direct link to heading">‚Äã</a></h4><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;without_guard_checking&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;src/proto_alpha/lib_protocol/apply.ml&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;src/proto_alpha/lib_protocol/misc.ml&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;src/proto_alpha/lib_protocol/raw_context.ml&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;src/proto_alpha/lib_protocol/script_interpreter.ml&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;src/proto_alpha/lib_protocol/storage_description.ml&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="value-25">Value<a class="hash-link" href="#value-25" title="Direct link to heading">‚Äã</a></h4><p>A list of filenames on which to disable termination checks by Coq.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="explanation-25">Explanation<a class="hash-link" href="#explanation-25" title="Direct link to heading">‚Äã</a></h4><p>This option turns off the flag <code>Guard Checking</code>:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Unset Guard Checking.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Thus it is possible to write fixpoints which are not syntactically terminating. To help the evaluation tactics to terminate in the proofs, we can combine this setting with the <a href="http://localhost:3000/coq-of-ocaml/docs/attributes#coq_struct" target="_blank" rel="noopener noreferrer">coq_struct</a> attribute.</p><p>For example, the following OCaml code:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">(* let split_at (c : char) (s : string) : (string * string) option = ... *)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rec</span><span class="token plain"> split_all </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> char</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> string list </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">match</span><span class="token plain"> split_at c s </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">None</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Some</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> s2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> s1 </span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> split_all c s2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>generates:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Fixpoint split_all (c : ascii) (s : string) : list string :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  match split_at c s with</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | None =&gt; [ s ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Some (s1, s2) =&gt; cons s1 (split_all c s2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>which is not accepted by Coq with the error:</p><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Error: Cannot guess decreasing argument of fix.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>despite the fact that we know that <code>split_at</code> should always return a smaller string. By disabling the guard checking, we can force Coq to accept this example of code. We automatically add a <code>struct</code> annotation on the first fixpoint argument so that Coq accepts the definition:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Fixpoint split_all (c : ascii) (s : string) {struct c} : list string :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  match split_at c s with</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | None =&gt; [ s ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Some (s1, s2) =&gt; cons s1 (split_all c s2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>However, we must be cautious as a <code>struct</code> annotation may break the symbolic evaluation of <code>split_all</code> since <code>c</code> never changes in recursive calls. For example:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Parameter P : ascii -&gt; string -&gt; list string -&gt; Prop.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Lemma split_all_property (c : ascii) (s : string) : P c s (split_all c s).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  destruct c; simpl.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>produces:</p><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Error: Stack overflow.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>because <code>split_all</code> is infinitely unfolded. With the <code>coq_struct</code> attribute we can force the <code>struct</code> annotation to be on the argument <code>s</code>:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rec</span><span class="token plain"> split_all </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> char</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> string list </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">match</span><span class="token plain"> split_at c s </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">None</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Some</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> s2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> s1 </span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> split_all c s2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">@@</span><span class="token plain">coq_struct </span><span class="token string" style="color:#e3116c">&quot;s&quot;</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>produces:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Fixpoint split_all (c : ascii) (s : string) {struct s} : list string :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  match split_at c s with</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | None =&gt; [ s ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Some (s1, s2) =&gt; cons s1 (split_all c s2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Then, neither:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">destruct c; simpl.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>nor:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">destruct s; simpl.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>breaks. For more information about the reduction strategies in Coq proofs, you can start with the documentation of the <a href="https://coq.inria.fr/refman/proof-engine/tactics.html#coq:tacn.simpl" target="_blank" rel="noopener noreferrer">simpl tactic</a>.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="without_positivity_checking">without_positivity_checking<a class="hash-link" href="#without_positivity_checking" title="Direct link to heading">‚Äã</a></h2><h4 class="anchor anchorWithStickyNavbar_31ik" id="example-26">Example<a class="hash-link" href="#example-26" title="Direct link to heading">‚Äã</a></h4><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;without_positivity_checking&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;src/proto_alpha/lib_protocol/storage_description.ml&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="value-26">Value<a class="hash-link" href="#value-26" title="Direct link to heading">‚Äã</a></h4><p>A list of filenames on which to disable the positivity checking.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="explanation-26">Explanation<a class="hash-link" href="#explanation-26" title="Direct link to heading">‚Äã</a></h4><p>This option turns off the flag <code>Positivity Checking</code>:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Unset Positivity Checking.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This allows to define types which would not respect the strict positivity condition:</p><div class="codeBlockContainer_K1bP language-ocaml theme-code-block"><div class="codeBlockContent_hGly ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> L </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>generates:</p><div class="codeBlockContainer_K1bP language-coq theme-code-block"><div class="codeBlockContent_hGly coq"><pre tabindex="0" class="prism-code language-coq codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Inductive t : Set :=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| L : (t -&gt; t) -&gt; t.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>which without this setting gives this error in Coq:</p><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Error: Non strictly positive occurrence of &quot;t&quot; in &quot;(t -&gt; t) -&gt; t&quot;.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/coq-of-ocaml/attributes"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Attributes</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/coq-of-ocaml/examples"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Examples</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#alias_barrier_modules" class="table-of-contents__link toc-highlight">alias_barrier_modules</a></li><li><a href="#constant_warning" class="table-of-contents__link toc-highlight">constant_warning</a></li><li><a href="#constructor_map" class="table-of-contents__link toc-highlight">constructor_map</a></li><li><a href="#error_category_blacklist" class="table-of-contents__link toc-highlight">error_category_blacklist</a></li><li><a href="#error_filename_blacklist" class="table-of-contents__link toc-highlight">error_filename_blacklist</a></li><li><a href="#error_message_blacklist" class="table-of-contents__link toc-highlight">error_message_blacklist</a></li><li><a href="#escape_value" class="table-of-contents__link toc-highlight">escape_value</a></li><li><a href="#first_class_module_path_blacklist" class="table-of-contents__link toc-highlight">first_class_module_path_blacklist</a></li><li><a href="#first_class_module_signature_blacklist" class="table-of-contents__link toc-highlight">first_class_module_signature_blacklist</a></li><li><a href="#head_suffix" class="table-of-contents__link toc-highlight">head_suffix</a></li><li><a href="#merge_returns" class="table-of-contents__link toc-highlight">merge_returns</a></li><li><a href="#merge_types" class="table-of-contents__link toc-highlight">merge_types</a></li><li><a href="#monadic_lets" class="table-of-contents__link toc-highlight">monadic_lets</a></li><li><a href="#monadic_let_returns" class="table-of-contents__link toc-highlight">monadic_let_returns</a></li><li><a href="#monadic_returns" class="table-of-contents__link toc-highlight">monadic_returns</a></li><li><a href="#monadic_return_lets" class="table-of-contents__link toc-highlight">monadic_return_lets</a></li><li><a href="#operator_infix" class="table-of-contents__link toc-highlight">operator_infix</a></li><li><a href="#renaming_rules" class="table-of-contents__link toc-highlight">renaming_rules</a></li><li><a href="#renaming_type_constructor" class="table-of-contents__link toc-highlight">renaming_type_constructor</a></li><li><a href="#require" class="table-of-contents__link toc-highlight">require</a></li><li><a href="#require_import" class="table-of-contents__link toc-highlight">require_import</a></li><li><a href="#require_long_ident" class="table-of-contents__link toc-highlight">require_long_ident</a></li><li><a href="#require_mli" class="table-of-contents__link toc-highlight">require_mli</a></li><li><a href="#variant_constructors" class="table-of-contents__link toc-highlight">variant_constructors</a></li><li><a href="#variant_types" class="table-of-contents__link toc-highlight">variant_types</a></li><li><a href="#without_guard_checking" class="table-of-contents__link toc-highlight">without_guard_checking</a></li><li><a href="#without_positivity_checking" class="table-of-contents__link toc-highlight">without_positivity_checking</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Content</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/company/about">Company</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/company/claims">Claims</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/company/press">Press</a></li></ul></div><div class="col footer__col"><div class="footer__title">Links</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/LandFoobar" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://fr.linkedin.com/company/formal-land" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Linkedin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://t.me/formal_land" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Telegram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.tiktok.com/@formal.land" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>TikTok<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="mailto:contact@formal.land" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Email<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/formal-land" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://gitlab.com/formal-land" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitLab<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://formal-land.gitlab.io/coq-tezos-of-ocaml/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Coq Tezos of OCaml<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2023 Formal Land (Arae SARL) üê¶, Paris<br><em>Unbreakable safety with formal verification üèá</em><!-- Start of LiveChat (www.livechat.com) code -->
<script>window.__lc=window.__lc||{},window.__lc.license=14938650,function(n,t,c){function i(n){return e._h?e._h.apply(null,n):e._q.push(n)}var e={_q:[],_h:null,_v:"2.0",on:function(){i(["on",c.call(arguments)])},once:function(){i(["once",c.call(arguments)])},off:function(){i(["off",c.call(arguments)])},get:function(){if(!e._h)throw new Error("[LiveChatWidget] You can't use getters before load.");return i(["get",c.call(arguments)])},call:function(){i(["call",c.call(arguments)])},init:function(){var n=t.createElement("script");n.async=!0,n.type="text/javascript",n.src="https://cdn.livechatinc.com/tracking.js",t.head.appendChild(n)}};!n.__lc.asyncInit&&e.init(),n.LiveChatWidget=n.LiveChatWidget||e}(window,document,[].slice)</script>
<noscript><a href="https://www.livechat.com/chat-with/14938650/" rel="nofollow">Chat with us</a>, powered by <a href="https://www.livechat.com/?welcome" rel="noopener nofollow" target="_blank">LiveChat</a></noscript>
<!-- End of LiveChat code --></div></div></div></footer></div>
<script src="/assets/js/runtime~main.09c92dd9.js"></script>
<script src="/assets/js/main.7add5677.js"></script>
</body>
</html>